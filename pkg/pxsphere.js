var y=class n extends Float32Array{static size=3;constructor(e,t,r){super(n.size),this.set(e??0,t,r)}static fromBuffer(e,t){return new Float32Array(e,t,3)}static create(){return new n}clone(){return new n(this)}put(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this}set(e,t,r){return typeof e=="number"?(this[0]=e,this[1]=t??0,this[2]=r??0):super.set(e),this}static set(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}copy(e){return this.set(e),this}static copy(e,t){return e.set(t),e}add(e){return this[0]+=e[0],this[1]+=e[1],this[2]+=e[2],this}static add(e,t,r){return r=r??new n,r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}addScalar(e){return this[0]+=e,this[1]+=e,this[2]+=e,this}static addScalar(e,t,r){return r=r??new n,r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r}sub(e){return this[0]-=e[0],this[1]-=e[1],this[2]-=e[2],this}static sub(e,t,r){return r=r??new n,r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}subScalar(e){return this[0]-=e,this[1]-=e,this[2]-=e,this}static subScalar(e,t,r){return r=r??new n,r[0]-=t,r[1]-=t,r[2]-=t,r}mul(e){return this[0]*=e[0],this[1]*=e[1],this[2]*=e[2],this}static mul(e,t,r){return r=r??new n,r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}mulScalar(e){return this[0]*=e,this[1]*=e,this[2]*=e,this}static mulScalar(e,t,r){return r=r??new n,r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r}div(e){return this[0]/=e[0],this[1]/=e[1],this[2]/=e[2],this}static div(e,t,r){return r=r??new n,r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r}divScalar(e){return this[0]/=e,this[1]/=e,this[2]/=e,this}static divScalar(e,t,r){return r=r??new n,r[0]=e[0]/t,r[1]=e[1]/t,r[2]=e[2]/t,r}dot(e){return this.x*e[0]+this.y*e[1]+this.z*e[2]}static dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}dotScalar(e,t,r){return this.x*e+this.y*t+this.z*r}static dotScalar(e,t,r,i){return e[0]*t+e[1]*r+e[2]*i}normalise(){return this.mulScalar(1/this.len())}static normalise(e){if(Array.isArray(e)||e instanceof Float32Array){let t=1/n.len(e);for(let r=0;r!==3;++r)e[r]*=t;return e}else if(e instanceof n)return e.mulScalar(1/e.len())}cross(e){let t=this.x,r=this.y,i=this.z;return this.x=r*e[2]-i*e[1],this.y=i*e[0]-t*e[2],this.z=t*e[1]-r*e[0],this}static cross(e,t,r){return r=r??new n,r[0]=e[1]*t[2]-e[2]*t[1],r[1]=e[2]*t[0]-e[0]*t[2],r[2]=e[0]*t[1]-e[1]*t[0],r}static crossF(e,t,r,i){e[t]=r[1]*i[2]-r[2]*i[1],e[t+1]=r[2]*i[0]-r[0]*i[2],e[t+2]=r[0]*i[1]-r[1]*i[0]}lenSq(){return this.dot(this)}static lenSq(e){return n.dot(e,e)}len(){return Math.sqrt(this.lenSq())}static len(e){return Math.sqrt(n.dot(e,e))}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}};var ye=Math.PI,st=2*ye,ot=ye/2;function K(n,e,t=1e-6){return Math.abs(n-e)<t}function q(n,e,t){return n<e?e:n>t?t:n}function re(n,e,t){return t=q((t-n)/(e-n),0,1),t*t*(3-2*t)}function Q(n,e,t){return(1-t)*n+t*e}function Ae(n,e,t,r){let i=1-r;for(let s=0;s!==t.length;++s)t[s]=i*n[s]+r*e[s]}var U=class n extends Float32Array{static size=2;constructor(e,t){super(n.size),this.set(e??0,t??(typeof e=="number"?e:void 0))}static create(){return new n}clone(){return new n(this)}put(e,t){return this[0]=e,this[1]=t,this}set(e,t){return typeof e=="number"?(this[0]=e,this[1]=t??0):super.set(e),this}static set(e,t,r){return e[0]=t,e[1]=r,e}copy(e){return this.set(e),this}static copy(e,t){return e.set(t),e}add(e){return this[0]+=e[0],this[1]+=e[1],this}static add(e,t,r){return r=r??new n,r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}addScalar(e){return this[0]+=e,this[1]+=e,this}static addScalar(e,t,r){return r=r??new n,r[0]=e[0]+t,r[1]=e[1]+t,r}addScaled(e,t){return this[0]+=e[0]*t,this[1]+=e[1]*t,this}static addScaled(e,t,r,i){return i=i??new n,i[0]=e[0]+t[0]*r,i[1]=e[1]+t[1]*r,i}sub(e){return this[0]-=e[0],this[1]-=e[1],this}static sub(e,t,r){return r=r??new n,r[0]=e[0]-t[0],r[1]=e[1]-t[1],r}subScalar(e){return this[0]-=e,this[1]-=e,this}static subScalar(e,t,r){return r=r??new n,r[0]-=t,r[1]-=t,r}mul(e){return this[0]*=e[0],this[1]*=e[1],this}static mul(e,t,r){return r=r??new n,r[0]=e[0]*t[0],r[1]=e[1]*t[1],r}mulScalar(e){return this[0]*=e,this[1]*=e,this}static mulScalar(e,t,r){return r=r??new n,r[0]=e[0]*t,r[1]=e[1]*t,r}div(e){return this[0]/=e[0],this[1]/=e[1],this}static div(e,t,r){return r=r??new n,r[0]=e[0]/t[0],r[1]=e[1]/t[1],r}divScalar(e){return this[0]/=e,this[1]/=e,this}static divScalar(e,t,r){return r=r??new n,r[0]=e[0]/t,r[1]=e[1]/t,r}dot(e){return this.x*e[0]+this.y*e[1]}static dot(e,t){return e[0]*t[0]+e[1]*t[1]}static perp(e){return new n(-e.y,e.x)}dotScalar(e,t){return this.x*e+this.y*t}static dotScalar(e,t,r){return e[0]*t+e[1]*r}normalise(){return this.mulScalar(1/this.len)}static normalise(e){if(Array.isArray(e)||e instanceof Float32Array){let t=1/n.len(e);return e[0]*=t,e[1]*=t,e}else if(e instanceof n)return e.mulScalar(1/e.len)}static kross(e,t){return e[0]*t[1]-e[1]*t[0]}static reflect(e,t){let r=2*n.dot(e,t),i=n.mulScalar(t,r);return n.sub(e,i)}clamp(e,t){return this.x=q(this.x,e,t),this.y=q(this.x,e,t),this}apply(e){return this.x=e(this.x),this.y=e(this.y),this}static distSq(e,t){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}static dist(e,t){return Math.sqrt(n.distSq(e,t))}lenSq(){return this.dot(this)}static lenSq(e){return n.dot(e,e)}get len(){return Math.sqrt(this.lenSq())}static len(e){return Math.sqrt(n.dot(e,e))}invert(){return this.x=1/this.x,this.y=1/this.y,this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}};function ze(n,e,t){let r=t&&t.state;r&&(typeof r=="object"&&e.copy(r,e),n.state=()=>e.copy(e,{}))}function Oe(n,e){let t=()=>(n.next()>>>0)/4294967296;return t.double=()=>{let r,i,s;do r=n.next()>>>11,i=(n.next()>>>0)/4294967296,s=(r+i)/(1<<21);while(s===0);return s},t.int32=()=>n.next()|0,t.quick=t,ze(t,n,e),t}var Z=Ee;function Ee(n,e){let t=new he(n);return Oe(t,e)}var he=class{constructor(e){e==null&&(e=+new Date);let t="";this.x=0,this.y=0,this.z=0,this.w=0,e===(e|0)?this.x=e:t+=e;for(let r=0;r<t.length+64;r++)this.x^=t.charCodeAt(r)|0,this.next()}next(){let{x:e,y:t,z:r,w:i}=this,s=e^e<<11;return this.x=t,this.y=r,this.z=i,this.w=i^(i>>>19^s^s>>>8)}copy(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}};function*ve(n){let i=Math.cos(2*Math.PI*4/11),s=Math.sin(2*Math.PI*4/11),o=Math.tan(.5*n),u=o*o,b=Math.ceil((1-1e-6)*Math.PI*(1+Math.sqrt(2))/3/n),f=2*b+8,d=new Float64Array(8*(b+4)*(b+4)).fill(NaN),a=[],x=Z(123),[g,L]=S();yield J(g,L,j(g,L));e:for(;a.length;){let m=x.double()*a.length|0,l=a[m],c=p(2*x.double()-1),V=1/(1+c*c),k,w,M;w=V?(1-c*c)*V:-1,M=V?2*c*V:0;for(let P=0;P<11;++P){k=w,w=k*i-M*s,M=k*s+M*i;let W=A(),F=l[0],T=l[1],D=W*w,z=W*M,$=F+D,ne=T+z,O=1-F*D-T*z,B=F*z-T*D,E=1/(O*O+B*B);if(E===1/0)continue;let Y=E*($*O-ne*B),ge=E*(ne*O+$*B),xe=j(Y,ge);if(xe){yield J(Y,ge,xe);continue e}}let C=a.pop();m<a.length&&(a[m]=C)}function A(){let m=x.double(),l=x.double();return o*(1+1e-6+.65*m*l)}function p(m){let l=1-m*m;return m*(-.0187108*l+.31583526+1.27365776/l)}function S(){let m=p(2*x.double()-1),l=.25*x.double(),c=Math.sqrt(l/(1-l)),V=1/(1+m*m);return V!==0?[(1-m*m)*(c*V),2*m*(c*V)]:[-c,0]}function te(m,l,c,V,k){let w=c-m,M=V-l,C=1+m*c+l*V,P=m*V-l*c;return w*w+M*M<=k*(C*C+P*P)}function j(m,l){let c=m,V=l,k=(m>=0)-(m<0),w=(l>=0)-(l<0),M=k*w;m*=k,l*=w;let C=1/(m*m+l*l),P=C<1;C!==0|C!==1/0?(m*=C*P+!P,l*=C*P+!P):(m=0,l=0);let W=m;m=4/Math.PI*Math.atan2(W,1+l),l=4/Math.PI*Math.atan2(l,1+W),W=m,m=!P*m+P*(1-l),l=!P*l+P*(1-W),m*=b,l*=b;let F=m|0,T=l|0,D=m-F,z=l-T;F-=M*(M*(2*D+z)<1.5*M-.5)*(M*(z-D)>0),T-=M*(M*(2*z+D)<1.5*M-.5)*(M*(z-D)<=0),F=k*F-(k<0),T=w*T-(w<0);let $=T+b+1,ne=F+b+1;for(let O=$;O<$+7;++O){let B=2*(O*f+ne);for(let E=B;E<B+14;E+=2){let Y=d[E];if(Y===Y&&te(c,V,Y,d[E+1],u))return!1}}return[F,T]}function G(m,l,c,V){let k=l+b+4,w=m+b+4,M=2*(f*k+w);d[M]=c,d[M+1]=V}function N(m){let l=(m>0)-(m<=0);return~(m-l*b)+l*b}function J(m,l,[c,V]){let k=b,w=[m,l];G(c,V,m,l);let M=c>k-4|c<=-k+4,C=V>k-4|V<=-k+4;return M&&(G(N(c),~V,m,l),C&&G(~N(c),~N(V),m,l)),C&&G(~c,N(V),m,l),a.push(w),w}}function Ve(n,e,t){e=Math.floor(e),t=Math.floor(t);let r=new Float32Array(2*e*t);for(let s=0;s<t;++s)for(let o=0;o<e;++o){let u=2*(s*e+o);r[u]=o/e,r[u+1]=s/t}let i=n.createVertexArray();if(i!=null){n.bindVertexArray(i);let s=n.createBuffer();return s==null?null:(n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,r,n.STATIC_DRAW),n.enableVertexAttribArray(0),n.vertexAttribPointer(0,2,n.FLOAT,!1,0,0),n.bindVertexArray(null),[i,s,r.length/2])}return null}function Ge(n,e){let t=1+n*n+e*e,r=2*n/t,i=2*e/t,s=(-1+n*n+e*e)/t;return new y(r,i,s)}function Le(n,e){let t=ve(e),r=[],i=!1;for(;!i;){let u=t.next();u==null||u.done===!0?i=!0:u.value!=null&&r.push(Ge(u.value[0],u.value[1]))}let s=new Float32Array(r.length*3);r.forEach((u,b)=>{s[b*3]=u.x,s[b*3+1]=u.y,s[b*3+2]=u.z});let o=n.createVertexArray();if(o!=null){n.bindVertexArray(o);let u=n.createBuffer();return u==null?null:(n.bindBuffer(n.ARRAY_BUFFER,u),n.bufferData(n.ARRAY_BUFFER,s,n.STATIC_DRAW),n.enableVertexAttribArray(0),n.vertexAttribPointer(0,3,n.FLOAT,!1,0,0),n.bindVertexArray(null),[o,u,r.length])}return null}function be(n,e,t){let r=[[e,n.VERTEX_SHADER,"vertex"],[t,n.FRAGMENT_SHADER,"fragment"]],i=[],s=n.createProgram();if(s==null)return"Failed to create shader program";for(let o=0;o!==r.length;++o){let u=n.createShader(r[o][1]);if(u==null)return`Failed to create ${r[o][2]} shader`;let b=r[o][0];if(b.includes("#version")||(console.log("inserting version"),b=`#version 300 es
${b}`),n.shaderSource(u,b),n.compileShader(u),n.getShaderParameter(u,n.COMPILE_STATUS)===!0)i.push(u),n.attachShader(s,u);else{i.forEach(d=>{n.deleteShader(d)});let f=n.getShaderInfoLog(u)??"unknown";return`Failed to create ${r[o][2]} shader with error:
${f}`}}if(n.linkProgram(s),i.forEach(o=>{n.deleteShader(o)}),n.getProgramParameter(s,n.LINK_STATUS)===!0)return s;{let o=n.getProgramInfoLog(s)??"unknown";return n.deleteProgram(s),`Failed to create program with error:
${o}`}}var R=class n extends Float32Array{static size=9;constructor(){super(n.size)}static create(e){let t=new n;return e!=null&&t.set(e),t}static idx(e,t){return 3*t+e}static set(e,t,r,i){e[n.idx(t,r)]=i}static get(e,t,r){return e[n.idx(t,r)]}static fromMat4Rotation(e){let t=n.create();return n.setColumn(t,0,h.getColumn(e,0)),n.setColumn(t,1,h.getColumn(e,1)),n.setColumn(t,2,h.getColumn(e,2)),t}copyMat4Rotation(e){return n.setColumn(this,0,h.getColumn(e,0)),n.setColumn(this,1,h.getColumn(e,1)),n.setColumn(this,2,h.getColumn(e,2)),this}static getColumn(e,t){return[e[n.idx(0,t)],e[n.idx(1,t)],e[n.idx(2,t)]]}static setColumn(e,t,r){e[n.idx(0,t)]=r[0],e[n.idx(1,t)]=r[1],e[n.idx(2,t)]=r[2]??(t===2?1:0)}static makeTranslation(e,t){let r=n.makeIdentity();return r[n.idx(0,2)]=e,r[n.idx(1,2)]=t,r}static translate(e,t,r){if(typeof r=="number")e[n.idx(0,2)]=t,e[n.idx(1,2)]=r;else{let i=t;e[n.idx(0,2)]=i[0],e[n.idx(1,2)]=i[1]}return e}static makeIdentity(){let e=n.create();return e[n.idx(0,0)]=1,e[n.idx(1,1)]=1,e[n.idx(2,2)]=1,e}static makeRotation(e){let[t,r]=[Math.cos(e),Math.sin(e)],i=n.create();return n.set(i,0,0,t),n.set(i,0,1,-r),n.set(i,1,0,r),n.set(i,1,1,t),n.set(i,2,2,1),i}static rotate(e,t){let[r,i]=[Math.cos(t),Math.sin(t)];return n.set(e,0,0,r),n.set(e,0,1,-i),n.set(e,1,0,i),n.set(e,1,1,r),n.set(e,2,2,1),e}static makeScale(e){let t=n.create();return n.set(t,0,0,e[0]),n.set(t,1,1,e[1]),n.set(t,2,2,1),t}static scale(e,t){return n.set(e,0,0,t[0]),n.set(e,1,1,t[1]),n.set(e,2,2,1),e}static scaleBy(e,t){return n.set(e,0,0,n.get(e,0,0)*t[0]),n.set(e,0,1,n.get(e,0,1)*t[1]),n.set(e,1,0,n.get(e,1,0)*t[0]),n.set(e,1,1,n.get(e,1,1)*t[1]),e}static makeTransform(e,t,r){let i=n.create();return n.set(i,0,0,t[0]*Math.cos(r)),n.set(i,0,1,-t[1]*Math.sin(r)),n.set(i,1,0,t[0]*Math.sin(r)),n.set(i,1,1,t[1]*Math.cos(r)),n.set(i,0,2,e[0]),n.set(i,1,2,e[1]),n.set(i,2,2,1),i}mul2(e){let t=e[0],r=e[1];return e[0]=n.get(this,0,0)*t+n.get(this,0,1)*r,e[1]=n.get(this,1,0)*t+n.get(this,1,1)*r,e}transform2(e){let t=e[0],r=e[1];return e[0]=n.get(this,0,0)*t+n.get(this,0,1)*r+n.get(this,0,2),e[1]=n.get(this,1,0)*t+n.get(this,1,1)*r+n.get(this,1,2),e}static transform2(e,t,r,i){let s=t[0],o=t[1],u=i??0;return r[u]=n.get(e,0,0)*s+n.get(e,0,1)*o+n.get(e,0,2),r[u+1]=n.get(e,1,0)*s+n.get(e,1,1)*o+n.get(e,1,2),r}static mul(e,t,r){return n.set(e,0,0,n.get(t,0,0)*n.get(r,0,0)+n.get(t,0,1)*n.get(r,1,0)+n.get(t,0,2)*n.get(r,2,0)),n.set(e,0,1,n.get(t,0,0)*n.get(r,0,1)+n.get(t,0,1)*n.get(r,1,1)+n.get(t,0,2)*n.get(r,2,1)),n.set(e,0,2,n.get(t,0,0)*n.get(r,0,2)+n.get(t,0,1)*n.get(r,1,2)+n.get(t,0,2)*n.get(r,2,2)),n.set(e,1,0,n.get(t,1,0)*n.get(r,0,0)+n.get(t,1,1)*n.get(r,1,0)+n.get(t,1,2)*n.get(r,2,0)),n.set(e,1,1,n.get(t,1,0)*n.get(r,0,1)+n.get(t,1,1)*n.get(r,1,1)+n.get(t,1,2)*n.get(r,2,1)),n.set(e,1,2,n.get(t,1,0)*n.get(r,0,2)+n.get(t,1,1)*n.get(r,1,2)+n.get(t,1,2)*n.get(r,2,2)),n.set(e,2,0,n.get(t,2,0)*n.get(r,0,0)+n.get(t,2,1)*n.get(r,1,0)+n.get(t,2,2)*n.get(r,2,0)),n.set(e,2,1,n.get(t,2,0)*n.get(r,0,1)+n.get(t,2,1)*n.get(r,1,1)+n.get(t,2,2)*n.get(r,2,1)),n.set(e,2,2,n.get(t,2,0)*n.get(r,0,2)+n.get(t,2,1)*n.get(r,1,2)+n.get(t,2,2)*n.get(r,2,2)),e}static inverse(e,t=1e-4){let r=n.create();r[0]=e[4]*e[8]-e[5]*e[7],r[1]=e[2]*e[7]-e[1]*e[8],r[2]=e[1]*e[5]-e[2]*e[4],r[3]=e[5]*e[6]-e[3]*e[8],r[4]=e[0]*e[8]-e[2]*e[6],r[5]=e[2]*e[3]-e[0]*e[5],r[6]=e[3]*e[7]-e[4]*e[6],r[7]=e[1]*e[6]-e[0]*e[7],r[8]=e[0]*e[4]-e[1]*e[3];let i=e[0]*r[0]+e[1]*r[3]+e[2]*r[6];if(Math.abs(i)>t){let s=1/i;return r[0]*=s,r[1]*=s,r[2]*=s,r[3]*=s,r[4]*=s,r[5]*=s,r[6]*=s,r[7]*=s,r[8]*=s,r}return n.create()}static transpose(e){let t=n.idx,r=e[t(0,1)];return e[t(0,1)]=e[t(1,0)],e[t(1,0)]=r,r=e[t(0,2)],e[t(0,2)]=e[t(2,0)],e[t(2,0)]=r,r=e[t(1,2)],e[t(1,2)]=e[t(2,1)],e[t(2,1)]=r,e}};var h=class n extends Float32Array{static size=16;constructor(){super(n.size)}static create(e){let t=new n;return e!=null&&t.set(e),t}static fromMat3(e){let t=n.makeIdentity();return n.set(t,0,0,R.get(e,0,0)),n.set(t,0,1,R.get(e,0,1)),n.set(t,0,3,R.get(e,0,2)),n.set(t,1,0,R.get(e,1,0)),n.set(t,1,1,R.get(e,1,1)),n.set(t,1,3,R.get(e,1,2)),t}static idx(e,t){return 4*t+e}static set(e,t,r,i){e[n.idx(t,r)]=i}static get(e,t,r){return e[n.idx(t,r)]}static makePerspective(e,t,r,i){let s=n.create(),o=Math.tan(e*Math.PI/360);return s[n.idx(0,0)]=1/(t*o),s[n.idx(1,1)]=1/o,s[n.idx(2,2)]=i/(r-i),s[n.idx(2,3)]=-(r*i)/(i-r),s[n.idx(3,2)]=-1,s}static getColumn(e,t){return[e[n.idx(0,t)],e[n.idx(1,t)],e[n.idx(2,t)],e[n.idx(3,t)]]}static setColumn(e,t,r){e[n.idx(0,t)]=r[0],e[n.idx(1,t)]=r[1],e[n.idx(2,t)]=r[2],e[n.idx(3,t)]=r[3]??(t===3?1:0)}static makeOrtho(e,t,r,i,s,o){let u=1/(e-t),b=1/(r-i),f=1/(s-o),d=n.create();return d[0]=-2*u,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=-2*b,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=2*f,d[11]=0,d[12]=(e+t)*u,d[13]=(i+r)*b,d[14]=(o+s)*f,d[15]=1,d}static makeTranslation(e,t,r){let i=n.makeIdentity();return i[n.idx(0,3)]=e,i[n.idx(1,3)]=t,i[n.idx(2,3)]=r,i}static makeXAxisReflection(){let e=n.makeIdentity();return e[n.idx(0,0)]=-1,e}static makeYAxisReflection(){let e=n.makeIdentity();return e[n.idx(1,1)]=-1,e}static makeZAxisReflection(){let e=n.makeIdentity();return e[n.idx(2,2)]=-1,e}static translate(e,t,r,i){return e[n.idx(0,3)]=t,e[n.idx(1,3)]=r,e[n.idx(2,3)]=i,e}static makeIdentity(){let e=n.create();return e[n.idx(0,0)]=1,e[n.idx(1,1)]=1,e[n.idx(2,2)]=1,e[n.idx(3,3)]=1,e}static makeRotation(e,t){K(y.len(e),1)||(console.log("Warning, input axis to makeRotation should be unit length"),y.normalise(e));let[r,i,s]=[Math.cos(t),Math.sin(t),1-Math.cos(t)],[o,u,b]=[s*e[0],s*e[1],s*e[2]],[f,d,a]=[i*e[0],i*e[1],i*e[2]],[x,g,L]=[o*e[1],u*e[2],o*e[2]],A=n.create();return n.set(A,0,0,o*e[0]+r),n.set(A,0,1,x+a),n.set(A,0,2,L-d),n.set(A,1,0,x-a),n.set(A,1,1,u*e[1]+r),n.set(A,1,2,g+f),n.set(A,2,0,L+d),n.set(A,2,1,g-f),n.set(A,2,2,b*e[2]+r),n.set(A,3,3,1),A}static rotate(e,t,r){K(y.len(t),1)||(console.log("Warning, input axis to makeRotation should be unit length"),y.normalise(t));let[i,s,o]=[Math.cos(r),Math.sin(r),1-Math.cos(r)],[u,b,f]=[o*t[0],o*t[1],o*t[2]],[d,a,x]=[s*t[0],s*t[1],s*t[2]],[g,L,A]=[u*t[1],b*t[2],u*t[2]];return n.set(e,0,0,u*t[0]+i),n.set(e,0,1,g+x),n.set(e,0,2,A-a),n.set(e,1,0,g-x),n.set(e,1,1,b*t[1]+i),n.set(e,1,2,L+d),n.set(e,2,0,A+a),n.set(e,2,1,L-d),n.set(e,2,2,f*t[2]+i),e}static makeScale(e){let t=n.create();return n.set(t,0,0,e[0]),n.set(t,1,1,e[1]),n.set(t,2,2,e[2]),n.set(t,3,3,1),t}static scale(e,t){return n.set(e,0,0,t[0]),n.set(e,1,1,t[1]),n.set(e,2,2,t[2]),e}static makeTransform(e,t,r){let i=n.create();return n.rotate(i,[1,0,0],t[0]),n.rotate(i,[0,1,0],t[1]),n.rotate(i,[0,0,1],t[2]),n.scale(i,e),n.translate(i,r[0],r[1],r[2]),i}static mul(e,t,r){return n.set(e,0,0,n.get(t,0,0)*n.get(r,0,0)+n.get(t,0,1)*n.get(r,1,0)+n.get(t,0,2)*n.get(r,2,0)+n.get(t,0,3)*n.get(r,3,0)),n.set(e,0,1,n.get(t,0,0)*n.get(r,0,1)+n.get(t,0,1)*n.get(r,1,1)+n.get(t,0,2)*n.get(r,2,1)+n.get(t,0,3)*n.get(r,3,1)),n.set(e,0,2,n.get(t,0,0)*n.get(r,0,2)+n.get(t,0,1)*n.get(r,1,2)+n.get(t,0,2)*n.get(r,2,2)+n.get(t,0,3)*n.get(r,3,2)),n.set(e,0,3,n.get(t,0,0)*n.get(r,0,3)+n.get(t,0,1)*n.get(r,1,3)+n.get(t,0,2)*n.get(r,2,3)+n.get(t,0,3)*n.get(r,3,3)),n.set(e,1,0,n.get(t,1,0)*n.get(r,0,0)+n.get(t,1,1)*n.get(r,1,0)+n.get(t,1,2)*n.get(r,2,0)+n.get(t,1,3)*n.get(r,3,0)),n.set(e,1,1,n.get(t,1,0)*n.get(r,0,1)+n.get(t,1,1)*n.get(r,1,1)+n.get(t,1,2)*n.get(r,2,1)+n.get(t,1,3)*n.get(r,3,1)),n.set(e,1,2,n.get(t,1,0)*n.get(r,0,2)+n.get(t,1,1)*n.get(r,1,2)+n.get(t,1,2)*n.get(r,2,2)+n.get(t,1,3)*n.get(r,3,2)),n.set(e,1,3,n.get(t,1,0)*n.get(r,0,3)+n.get(t,1,1)*n.get(r,1,3)+n.get(t,1,2)*n.get(r,2,3)+n.get(t,1,3)*n.get(r,3,3)),n.set(e,2,0,n.get(t,2,0)*n.get(r,0,0)+n.get(t,2,1)*n.get(r,1,0)+n.get(t,2,2)*n.get(r,2,0)+n.get(t,2,3)*n.get(r,3,0)),n.set(e,2,1,n.get(t,2,0)*n.get(r,0,1)+n.get(t,2,1)*n.get(r,1,1)+n.get(t,2,2)*n.get(r,2,1)+n.get(t,2,3)*n.get(r,3,1)),n.set(e,2,2,n.get(t,2,0)*n.get(r,0,2)+n.get(t,2,1)*n.get(r,1,2)+n.get(t,2,2)*n.get(r,2,2)+n.get(t,2,3)*n.get(r,3,2)),n.set(e,2,3,n.get(t,2,0)*n.get(r,0,3)+n.get(t,2,1)*n.get(r,1,3)+n.get(t,2,2)*n.get(r,2,3)+n.get(t,2,3)*n.get(r,3,3)),n.set(e,3,0,n.get(t,3,0)*n.get(r,0,0)+n.get(t,3,1)*n.get(r,1,0)+n.get(t,3,2)*n.get(r,2,0)+n.get(t,3,3)*n.get(r,3,0)),n.set(e,3,1,n.get(t,3,0)*n.get(r,0,1)+n.get(t,3,1)*n.get(r,1,1)+n.get(t,3,2)*n.get(r,2,1)+n.get(t,3,3)*n.get(r,3,1)),n.set(e,3,2,n.get(t,3,0)*n.get(r,0,2)+n.get(t,3,1)*n.get(r,1,2)+n.get(t,3,2)*n.get(r,2,2)+n.get(t,3,3)*n.get(r,3,2)),n.set(e,3,3,n.get(t,3,0)*n.get(r,0,3)+n.get(t,3,1)*n.get(r,1,3)+n.get(t,3,2)*n.get(r,2,3)+n.get(t,3,3)*n.get(r,3,3)),e}static transform3(e,t){let r=t[0],i=t[1],s=t[2];return t[0]=n.get(e,0,0)*r+n.get(e,0,1)*i+n.get(e,0,2)*s+n.get(e,0,3),t[1]=n.get(e,1,0)*r+n.get(e,1,1)*i+n.get(e,1,2)*s+n.get(e,1,3),t[2]=n.get(e,2,0)*r+n.get(e,2,1)*i+n.get(e,2,2)*s+n.get(e,2,3),t}static mul3(e,t){let r=t[0],i=t[1],s=t[2];return t[0]=n.get(e,0,0)*r+n.get(e,0,1)*i+n.get(e,0,2)*s,t[1]=n.get(e,1,0)*r+n.get(e,1,1)*i+n.get(e,1,2)*s,t[2]=n.get(e,2,0)*r+n.get(e,2,1)*i+n.get(e,2,2)*s,t}static mul4(e,t){let r=t[0],i=t[1],s=t[2],o=t[3];return t[0]=n.get(e,0,0)*r+n.get(e,0,1)*i+n.get(e,0,2)*s+n.get(e,0,3)*o,t[1]=n.get(e,1,0)*r+n.get(e,1,1)*i+n.get(e,1,2)*s+n.get(e,1,3)*o,t[2]=n.get(e,2,0)*r+n.get(e,2,1)*i+n.get(e,2,2)*s+n.get(e,2,3)*o,t[3]=n.get(e,3,0)*r+n.get(e,3,1)*i+n.get(e,3,2)*s+n.get(e,3,3)*o,t}static inverse(e,t=.001){let r=e[0]*e[5]-e[1]*e[4],i=e[0]*e[6]-e[2]*e[4],s=e[0]*e[7]-e[3]*e[4],o=e[1]*e[6]-e[2]*e[5],u=e[1]*e[7]-e[3]*e[5],b=e[2]*e[7]-e[3]*e[6],f=e[8]*e[13]-e[9]*e[12],d=e[8]*e[14]-e[10]*e[12],a=e[8]*e[15]-e[11]*e[12],x=e[9]*e[14]-e[10]*e[13],g=e[9]*e[15]-e[11]*e[13],L=e[10]*e[15]-e[11]*e[14],A=r*L-i*g+s*x+o*a-u*d+b*f,p=n.create();if(Math.abs(A)<=t)return p;p[0]=+e[5]*L-e[6]*g+e[7]*x,p[4]=-e[4]*L+e[6]*a-e[7]*d,p[8]=+e[4]*g-e[5]*a+e[7]*f,p[12]=-e[4]*x+e[5]*d-e[6]*f,p[1]=-e[1]*L+e[2]*g-e[3]*x,p[5]=+e[0]*L-e[2]*a+e[3]*d,p[9]=-e[0]*g+e[1]*a-e[3]*f,p[13]=+e[0]*x-e[1]*d+e[2]*f,p[2]=+e[13]*b-e[14]*u+e[15]*o,p[6]=-e[12]*b+e[14]*s-e[15]*i,p[10]=+e[12]*u-e[13]*s+e[15]*r,p[14]=-e[12]*o+e[13]*i-e[14]*r,p[3]=-e[9]*b+e[10]*u-e[11]*o,p[7]=+e[8]*b-e[10]*s+e[11]*i,p[11]=-e[8]*u+e[9]*s-e[11]*r,p[15]=+e[8]*o-e[9]*i+e[10]*r;let S=1/A;return p[0]*=S,p[1]*=S,p[2]*=S,p[3]*=S,p[4]*=S,p[5]*=S,p[6]*=S,p[7]*=S,p[8]*=S,p[9]*=S,p[10]*=S,p[11]*=S,p[12]*=S,p[13]*=S,p[14]*=S,p[15]*=S,p}static transpose(e){let t=n.idx,r=e[t(0,1)];return e[t(0,1)]=e[t(1,0)],e[t(1,0)]=r,r=e[t(0,2)],e[t(0,2)]=e[t(2,0)],e[t(2,0)]=r,r=e[t(0,3)],e[t(0,3)]=e[t(3,0)],e[t(3,0)]=r,r=e[t(1,2)],e[t(1,2)]=e[t(2,1)],e[t(2,1)]=r,r=e[t(1,3)],e[t(1,3)]=e[t(3,1)],e[t(3,1)]=r,r=e[t(2,3)],e[t(2,3)]=e[t(3,2)],e[t(3,2)]=r,e}static lookAt(e,t,r=[0,1,0]){let i,s,o,u,b,f,d,a,x,g,L=e[0],A=e[1],p=e[2],S=r[0],te=r[1],j=r[2],G=t[0],N=t[1],J=t[2],m=1e-6;if(Math.abs(L-G)<m&&Math.abs(A-N)<m&&Math.abs(p-J)<m)return n.makeIdentity();let l=n.create();return d=L-G,a=A-N,x=p-J,g=1/Math.hypot(d,a,x),d*=g,a*=g,x*=g,i=te*x-j*a,s=j*d-S*x,o=S*a-te*d,g=Math.hypot(i,s,o),K(g,0)?(i=0,s=0,o=0):(g=1/g,i*=g,s*=g,o*=g),u=a*o-x*s,b=x*i-d*o,f=d*s-a*i,g=Math.hypot(u,b,f),K(g,0)?(u=0,b=0,f=0):(g=1/g,u*=g,b*=g,f*=g),l[0]=i,l[1]=u,l[2]=d,l[3]=0,l[4]=s,l[5]=b,l[6]=a,l[7]=0,l[8]=o,l[9]=f,l[10]=x,l[11]=0,l[12]=-(i*L+s*A+o*p),l[13]=-(u*L+b*A+f*p),l[14]=-(d*L+a*A+x*p),l[15]=1,l}static makePlaneProjection(e,t,r){let i=n.create(),s=-y.dot(e,t),o=y.dot(e,r);return i[0]=o+s-r[0]*e[0],i[1]=-r[1]*e[0],i[2]=-r[2]*e[0],i[3]=-e[0],i[4]=-r[0]*e[1],i[5]=o+s-r[1]*e[1],i[6]=-r[2]*e[1],i[7]=-e[1],i[8]=-r[0]*e[2],i[9]=-r[1]*e[2],i[10]=o+s-r[2]*e[2],i[11]=-e[2],i[12]=-r[0]*s,i[13]=-r[1]*s,i[14]=-r[2]*s,i[15]=o,i}};var ie=class n extends Float32Array{static size=4;constructor(){super(n.size)}static create(e){let t=new Float32Array(n.size);return e!=null&&t.set(e),t}static idx(e,t){return 2*t+e}static set(e,t,r,i){e[n.idx(t,r)]=i}static get(e,t,r){return e[n.idx(t,r)]}static transform2(e,t,r){return U.set(t,n.get(e,0,0)*r[0]+n.get(e,0,1)*r[1],n.get(e,1,0)*r[0]+n.get(e,1,1)*r[1]),t}static makeIdentity(){let e=n.create();return e[n.idx(0,0)]=1,e[n.idx(1,1)]=1,e}static makeRotation(e){let[t,r]=[Math.cos(e),Math.sin(e)],i=n.create();return n.set(i,0,0,t),n.set(i,0,1,-r),n.set(i,1,0,r),n.set(i,1,1,t),i}static rotate(e,t){let[r,i]=[Math.cos(t),Math.sin(t)];return n.set(e,0,0,r),n.set(e,0,1,-i),n.set(e,1,0,i),n.set(e,1,1,r),e}static makeScale(e){let t=n.create();return n.set(t,0,0,e[0]),n.set(t,1,1,e[1]),t}static mul(e,t,r){return n.set(e,0,0,n.get(t,0,0)*n.get(r,0,0)+n.get(t,0,1)*n.get(r,1,0)),n.set(e,0,1,n.get(t,0,0)*n.get(r,0,1)+n.get(t,0,1)*n.get(r,1,1)),n.set(e,1,0,n.get(t,1,0)*n.get(r,0,0)+n.get(t,1,1)*n.get(r,1,0)),n.set(e,1,1,n.get(t,1,0)*n.get(r,0,1)+n.get(t,1,1)*n.get(r,1,1)),e}static inverse(e,t=1e-4){let r=n.create(),i=e[0]*e[3]-e[1]*e[2];if(Math.abs(i)>t){let s=1/i;r[0]=e[3]*s,r[1]=-e[1]*s,r[2]=-e[2]*s,r[3]=e[0]*s}else r.fill(0);return r}};var se=class n extends Float32Array{static size=4;constructor(e,t,r,i){super(n.size),this.set(e??0,t,r,i)}static create(){return new n}clone(){return new n(this)}put(e,t,r,i){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this}set(e,t,r,i){return typeof e=="number"?(this[0]=e,this[1]=t??0,this[2]=r??0,this[3]=i??0):super.set(e),this}static set(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e}copy(e){return this.set(e),this}static copy(e,t){return e.set(t),e}add(e){return this[0]+=e[0],this[1]+=e[1],this[2]+=e[2],this[3]+=e[3],this}static add(e,t,r){return r=r??new n,r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}addScalar(e){return this[0]+=e,this[1]+=e,this[2]+=e,this[3]+=e,this}static addScalar(e,t,r){return r=r??new n,r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r[3]=e[3]+t,r}sub(e){return this[0]-=e[0],this[1]-=e[1],this[2]-=e[2],this[3]-=e[3],this}static sub(e,t,r){return r=r??new n,r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r}subScalar(e){return this[0]-=e,this[1]-=e,this[2]-=e,this[3]-=e,this}static subScalar(e,t,r){return r=r??new n,r[0]-=t,r[1]-=t,r[2]-=t,r[3]-=t,r}mul(e){return this[0]*=e[0],this[1]*=e[1],this[2]*=e[2],this[3]*=e[3],this}static mul(e,t,r){return r=r??new n,r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3],r}mulScalar(e){return this[0]*=e,this[1]*=e,this[2]*=e,this[3]*=e,this}static mulScalar(e,t,r){return r=r??new n,r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}div(e){return this[0]/=e[0],this[1]/=e[1],this[2]/=e[2],this[3]/=e[3],this}static div(e,t,r){return r=r??new n,r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r[3]=e[3]/t[3],r}divScalar(e){return this[0]/=e,this[1]/=e,this[2]/=e,this[3]/=e,this}static divScalar(e,t,r){return r=r??new n,r[0]=e[0]/t,r[1]=e[1]/t,r[2]=e[2]/t,r[3]=e[3]/t,r}dot(e){return this.x*e[0]+this.y*e[1]+this.z*e[2]+this.w*e[3]}static dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}dotScalar(e,t,r,i){return this.x*e+this.y*t+this.z*r+this.w*i}static dotScalar(e,t,r,i,s){return e[0]*t+e[1]*r+e[2]*i+e[3]*s}normalise(){return this.mulScalar(1/this.len())}static normalise(e){if(Array.isArray(e)||e instanceof Float32Array){let t=1/n.len(e);for(let r=0;r!==4;++r)e[r]*=t;return e}else if(e instanceof n)return e.mulScalar(1/e.len())}lenSq(){return this.dot(this)}static lenSq(e){return n.dot(e,e)}len(){return Math.sqrt(this.lenSq())}static len(e){return Math.sqrt(n.dot(e,e))}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}get w(){return this[3]}set w(e){this[3]=e}};var v=(c=>(c[c.NONE=0]="NONE",c[c.BOOL=WebGL2RenderingContext.BOOL]="BOOL",c[c.UBYTE=WebGL2RenderingContext.UNSIGNED_BYTE]="UBYTE",c[c.BYTE=WebGL2RenderingContext.BYTE]="BYTE",c[c.USHORT=WebGL2RenderingContext.UNSIGNED_SHORT]="USHORT",c[c.SHORT=WebGL2RenderingContext.SHORT]="SHORT",c[c.UINT=WebGL2RenderingContext.UNSIGNED_INT]="UINT",c[c.INT=WebGL2RenderingContext.INT]="INT",c[c.HALF_FLOAT=WebGL2RenderingContext.HALF_FLOAT]="HALF_FLOAT",c[c.FLOAT=WebGL2RenderingContext.FLOAT]="FLOAT",c[c.VEC2=WebGL2RenderingContext.FLOAT_VEC2]="VEC2",c[c.VEC3=WebGL2RenderingContext.FLOAT_VEC3]="VEC3",c[c.VEC4=WebGL2RenderingContext.FLOAT_VEC4]="VEC4",c[c.IVEC2=WebGL2RenderingContext.INT_VEC2]="IVEC2",c[c.IVEC3=WebGL2RenderingContext.INT_VEC3]="IVEC3",c[c.IVEC4=WebGL2RenderingContext.INT_VEC4]="IVEC4",c[c.MAT2=WebGL2RenderingContext.FLOAT_MAT2]="MAT2",c[c.MAT3=WebGL2RenderingContext.FLOAT_MAT3]="MAT3",c[c.MAT4=WebGL2RenderingContext.FLOAT_MAT4]="MAT4",c[c.SAMPLER_2D=WebGL2RenderingContext.SAMPLER_2D]="SAMPLER_2D",c[c.SAMPLER_3D=WebGL2RenderingContext.SAMPLER_3D]="SAMPLER_3D",c[c.SAMPLER_CUBE=WebGL2RenderingContext.SAMPLER_CUBE]="SAMPLER_CUBE",c[c.ISAMPLER_2D=WebGL2RenderingContext.INT_SAMPLER_2D]="ISAMPLER_2D",c[c.ISAMPLER_3D=WebGL2RenderingContext.INT_SAMPLER_3D]="ISAMPLER_3D",c[c.ISAMPLER_CUBE=WebGL2RenderingContext.INT_SAMPLER_CUBE]="ISAMPLER_CUBE",c))(v||{});function Ne(n,e){let{dataType:t,location:r,value:i,count:s}=e;switch(t){case v.BOOL:case v.BYTE:case v.INT:case v.SHORT:case v.SAMPLER_2D:case v.SAMPLER_3D:case v.SAMPLER_CUBE:case v.ISAMPLER_2D:case v.ISAMPLER_3D:case v.ISAMPLER_CUBE:s===void 0||s<2?n.uniform1i(r,i):n.uniform1iv(r,new Int32Array(i));break;case v.FLOAT:case v.HALF_FLOAT:n.uniform1f(r,i);break;case v.UBYTE:case v.UINT:case v.USHORT:n.uniform1ui(r,i);break;case v.VEC2:n.uniform2fv(r,i);break;case v.VEC3:n.uniform3fv(r,i);break;case v.VEC4:n.uniform4fv(r,i);break;case v.IVEC2:n.uniform2iv(r,i);break;case v.IVEC3:n.uniform3iv(r,i);break;case v.IVEC4:n.uniform4iv(r,i);break;case v.MAT2:n.uniformMatrix2fv(r,!1,i);break;case v.MAT3:n.uniformMatrix3fv(r,!1,i);break;case v.MAT4:n.uniformMatrix4fv(r,!1,i);break;case 0:default:console.warn("Unrecognised uniform data type")}}function H(n,e){let t=Object.keys(e);for(let r=0;r!==t.length;++r)Ne(n,e[t[r]])}function We(n){return n?.name.startsWith("gl_")??n?.name.startsWith("webgl_")??!1}function Be(n){switch(n){case WebGL2RenderingContext.FLOAT:return 0;case WebGL2RenderingContext.FLOAT_VEC2:return U.create();case WebGL2RenderingContext.FLOAT_VEC3:return y.create();case WebGL2RenderingContext.FLOAT_VEC4:return se.create();case WebGL2RenderingContext.FLOAT_MAT2:return ie.create();case WebGL2RenderingContext.FLOAT_MAT3:return R.create();case WebGL2RenderingContext.FLOAT_MAT4:return h.create();case WebGL2RenderingContext.INT:return 0;case WebGL2RenderingContext.SAMPLER_2D:return 0;case WebGL2RenderingContext.SAMPLER_3D:return 0;case WebGL2RenderingContext.SAMPLER_CUBE:return 0;default:return null}}function me(n,e){let t={},r=n.getProgramParameter(e,n.ACTIVE_UNIFORMS);for(let i=0;i!==r;++i){let s=n.getActiveUniform(e,i);if(We(s)){console.log("builtin:",s);continue}if(s==null)continue;let{name:o,type:u,size:b}=s;t[o]={value:Be(u),location:n.getUniformLocation(e,o),dataType:u,count:b}}return t}var Me=`#version 300 es
precision mediump float;
#define PI 3.141592653589793238
#define TWO_PI (PI + PI)
vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x,289.0);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+1.0*C.xxx;vec3 x2=x0-i2+2.0*C.xxx;vec3 x3=x0-1.+3.0*C.xxx;i=mod(i,289.0);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=1.0/7.0;vec3  ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}layout(location=0)in vec3 position;uniform mat4 mvp;uniform mat4 mv;uniform float pointSize;uniform float time;uniform vec4 speeds;uniform vec4 layerControls;uniform vec4 landmass;uniform float randomSeed;uniform int visibility;uniform int scalePoints;uniform vec4 frequencies;
#define emissionSpeed speeds.x
#define evolutionSpeed speeds.y
#define rotationSpeed speeds.z
#define layerScaleDelta layerControls.y
#define emissionStart landmass.x
#define emissionEnd landmass.y
#define emissionHeight landmass.z
#define sealevel landmass.w
#define emissionFreq frequencies.x
#define landFreq frequencies.y
#define rotFreq frequencies.z
#define rotMag frequencies.w
out vec4 pos;vec2 rot(vec2 v,float a){return mat2(cos(a),-sin(a),sin(a),cos(a))*v;}float fBM(vec3 p){float f=0.0;f+=0.5000*snoise(p);p.xy=rot(p.xy,0.5);f+=0.2500*snoise(2.*p);p.xy=rot(p.xy,0.5);f+=0.1250*snoise(4.*p);p.xy=rot(p.xy,0.5);f+=0.0625*snoise(8.*p);return f/0.9375;}vec2 cart2sphere(vec3 coord){return vec2(atan(coord.z,coord.x),acos(coord.y));}mat3 buildFrame(vec3 N){vec3 U=mix(vec3(1.0,0.0,0.0),vec3(0.0,1.0,0.0),step(.9,abs(N.x)));vec3 B=cross(N,U);vec3 T=cross(B,N);return mat3(B,T,N);}float visTerm(float emission,float land){switch(visibility){case 0:return min(emission,land);case 1:return max(emission,land);case 2:return emission*land;}return min(emission,land);}void main(){vec3 N=normalize(position);float emission=fBM(emissionFreq*N+time*emissionSpeed+vec3(randomSeed));float land=fBM(landFreq*position+time*evolutionSpeed+vec3(randomSeed));float emissionFactor=smoothstep(emissionStart-0.1,emissionEnd+0.1,emission);land=smoothstep(sealevel-0.1,sealevel+0.1,land);vec3 vN=normalize((mv*vec4(N,0.)).xyz);float angle=dot(vN,vec3(0.,0.,1.))*.5+.5;float rotation=TWO_PI*snoise(rotFreq*N+rotationSpeed*time+vec3(-randomSeed,2.*randomSeed,0.));vec3 offset=0.1*rotMag*buildFrame(N)*vec3(rot(vec2(1.,0.),rotation),0.0);pos=vec4(position+emissionHeight*emissionFactor*emission*N+offset,angle*visTerm(emission,land));gl_Position=mvp*vec4(pos.xyz,1.);gl_PointSize=max(pointSize*layerScaleDelta*(scalePoints==1?angle:1.),1.);}`;var Se=`#version 300 es
precision mediump float;uniform vec4 layerControls;uniform float roundedPoints;uniform float opacity;in vec4 pos;out vec4 fragColour;
#define layerOpacity layerControls.x
#define layer int(layerControls.z)
#define useLayerColours layerControls.w > 0.
float length2(vec2 v){return dot(v,v);}const vec4 colours[5]=vec4[5](vec4(1.0,0.0,0.0,1.0),vec4(0.0,1.0,0.0,1.0),vec4(0.0,0.0,1.0,1.0),vec4(1.0,1.0,0.0,1.0),vec4(1.0,0.0,1.0,1.0));void main(){if(pos.w<1e-2||opacity==0.)discard;if(roundedPoints>0.){float d=length2(gl_PointCoord-.5);if(d>.25)discard;}fragColour=opacity*pos.w*layerOpacity*(useLayerColours?colours[layer]:vec4(1.0));}`;var ke=`#version 300 es
precision mediump float;vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec2 mod289(vec2 x){return x-floor(x*(1.0/289.0))*289.0;}vec3 permute(vec3 x){return mod289(((x*34.0)+1.0)*x);}float snoise(vec2 v){const vec4 C=vec4(0.211324865405187,0.366025403784439,-0.577350269189626,0.024390243902439);vec2 i=floor(v+dot(v,C.yy));vec2 x0=v-i+dot(i,C.xx);vec2 i1;i1=(x0.x>x0.y)?vec2(1.0,0.0):vec2(0.0,1.0);vec4 x12=x0.xyxy+C.xxzz;x12.xy-=i1;i=mod289(i);vec3 p=permute(permute(i.y+vec3(0.0,i1.y,1.0))+i.x+vec3(0.0,i1.x,1.0));vec3 m=max(0.5-vec3(dot(x0,x0),dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)),0.0);m=m*m;m=m*m;vec3 x=2.0*fract(p*C.www)-1.0;vec3 h=abs(x)-0.5;vec3 ox=floor(x+0.5);vec3 a0=x-ox;m*=1.79284291400159-0.85373472095314*(a0*a0+h*h);vec3 g;g.x=a0.x*x0.x+h.x*x0.y;g.yz=a0.yz*x12.xz+h.yz*x12.yw;return 130.0*dot(m,g);}
#define PI 3.141592653589793238
#define TWO_PI (PI + PI)
layout(location=0)in vec2 position;uniform mat4 mvp;uniform float pointSize;uniform float time;uniform vec3 resolution;uniform int layer;out vec2 uv;flat out float colourP;const float screenScale=2.2;vec3 mapToCylinder(vec2 uv,float radius,float t){const float width=6.0;float theta=uv.x*TWO_PI+t-PI/2.0;float s=abs(.5-uv.y)*.5;s=s*s+0.1*s+.1*snoise(uv*13.0);return vec3(-s*width*cos(theta),.75*(2.*uv.y-1.),s*width*sin(theta));}vec3 displacement(vec2 uv){return vec3(snoise(vec2(1.283,1.437)*uv),snoise(vec2(-1.823,0.934)*uv),snoise(vec2(-0.32,-1.38)*uv));}vec3 rotate(vec3 v,float theta){return mat3(cos(theta),0.,-sin(theta),0.,1.,0.,sin(theta),0.,cos(theta))*v;}float rand(vec2 co){return fract(sin(dot(co.xy,vec2(12.9898,78.233)))*43758.5453);}vec3 uvToSpherical(vec2 uv,float time){float p=smoothstep(0.0,0.5,time)-smoothstep(0.5,1.5,time);float phi=uv.x*TWO_PI+PI/2.+p*0.2*(rand(uv)*2.-1.);float theta=(1.-uv.y)*PI+p*0.2*(rand(uv)*2.-1.);return vec3(sin(theta)*cos(phi),cos(theta),sin(theta)*sin(phi));}void main(){uv=fract(position.xy+vec2(0e-3*time,0.0));vec2 pos=position.xy;colourP=snoise(200.*uv)*.5+.5;gl_PointSize=.25*pointSize+.75*pointSize*(snoise(100.*uv)*.5+.5);vec2 scale=vec2(resolution[2],1.)*screenScale;float ani=max(0.1*time,0.0);vec3 P=vec3(fract(pos)*scale,0.0);P.xy-=vec2(resolution[2]*.5,.5)*2.2;vec3 Q=mapToCylinder(pos,.5,0.)+.01*displacement(uv+2.*time+float(layer));vec3 S=uvToSpherical(pos,ani)+.01*displacement(uv+2.*time+float(layer));vec3 R=mix(mix(P,Q,0.),S,ani);R=rotate(R,4.0*ani*ani*(ani*PI/3.*float(layer+1)));gl_Position=mvp*vec4(R,1.0);gl_PointSize=mix(gl_PointSize,.5*gl_PointSize,smoothstep(0.0,1.0,ani));}`;var we=`#version 300 es
precision mediump float;float length2(vec2 v){return dot(v,v);}uniform float roundedPoints;uniform float time;uniform float opacity;in vec2 uv;flat in float colourP;out vec4 fragColour;const vec3 colour=vec3(34./255.99,46./255.99,55./255.99);void main(){float d=length2(gl_PointCoord-.5);if(d>.25)discard;vec3 pColour=mix(colour,mix(colour,vec3(1.),.4),1.15*colourP-0.15);float edge=1.-smoothstep(0.25*.6,.25*.9,d);fragColour=mix(vec4(colour,1.),vec4(mix(colour,pColour,edge),1.),opacity);}`;var je=["min","max","mul"],oe={none:"{}",about:'{"rotationSpeed":0,"dirChangeFreq":0.01,"dirChangeStrength":0,"dirChangeVariance":0,"layers":1,"sampleRadius":0.01,"layerStepDistance":0.01,"layerOpacityDelta":0,"pointSize":0.54,"opacity":1,"emissionFreq":17.5,"emissionSpeed":1.5,"emissionStart":-1,"emissionEnd":1,"emissionHeight":-1,"evolutionSpeed":0,"landFreq":0.1,"sealevel":1,"sealevelLayerDelta":0.5,"rotationFreq":0,"rotationMag":0,"angularRotSpeed":0,"visibility":"max","randomSeed":true,"layerColours":false,"roundedPoints":true,"lockAxes":true,"scalePoints":true,"showText":false,"line1":"Defining the future of","line2":"business solutions.","preset":"none","resolution":[2880,1580,1.8227848101265822]}',ai:'{"rotationSpeed":1.1,"dirChangeFreq":0.01,"dirChangeStrength":0.55,"dirChangeVariance":1,"layers":5,"sampleRadius":0.02,"layerStepDistance":0.07,"layerOpacityDelta":0.12,"pointSize":1.15,"opacity":1,"emissionFreq":2.9,"emissionSpeed":2.3,"emissionStart":1,"emissionEnd":0.61,"emissionHeight":-1,"evolutionSpeed":20,"landFreq":7.8,"sealevel":0.28,"sealevelLayerDelta":-0.5,"rotationFreq":0,"rotationMag":0,"angularRotSpeed":0,"visibility":"max","randomSeed":true,"layerColours":false,"roundedPoints":true,"lockAxes":true,"scalePoints":true,"resolution":[2880,1580,1.8227848101265822]}',b2b:'{"rotationSpeed":1,"dirChangeFreq":0.01,"dirChangeStrength":1,"dirChangeVariance":0,"layers":5,"sampleRadius":0.02,"layerStepDistance":0.44,"layerOpacityDelta":0,"pointSize":0.9,"opacity":1,"emissionFreq":13.2,"emissionSpeed":20,"emissionStart":-1,"emissionEnd":-0.23,"emissionHeight":-0.06,"evolutionSpeed":0,"landFreq":6.3,"sealevel":0.19,"sealevelLayerDelta":-0.5,"rotationFreq":40,"rotationMag":1,"angularRotSpeed":0,"visibility":"max","randomSeed":true,"layerColours":false,"roundedPoints":true,"lockAxes":true,"scalePoints":true,"resolution":[2880,1580,1.8227848101265822]}',clean:'{"rotationSpeed":0,"dirChangeFreq":1,"dirChangeStrength":0.55,"dirChangeVariance":1,"layers":1,"sampleRadius":0.02,"layerStepDistance":0.07,"layerOpacityDelta":0.12,"pointSize":0.72,"opacity":1,"emissionFreq":13.2,"emissionSpeed":10.2,"emissionStart":1,"emissionEnd":-1,"emissionHeight":0.34,"evolutionSpeed":11.6,"landFreq":2.6,"sealevel":0.21,"sealevelLayerDelta":-0.5,"rotationFreq":0,"rotationMag":0,"angularRotSpeed":0,"visibility":"max","randomSeed":true,"layerColours":false,"roundedPoints":true,"lockAxes":true,"scalePoints":true,"resolution":[2880,1580,1.8227848101265822]}',base:'{"rotationSpeed":0.8,"dirChangeFreq":0.01,"dirChangeStrength":0.01,"dirChangeVariance":0,"layers":3,"sampleRadius":0.02,"layerStepDistance":0.2,"layerOpacityDelta":0.5,"pointSize":0.5,"opacity":1,"emissionFreq":2,"emissionSpeed":4.3,"emissionStart":1,"emissionEnd":-0.7,"emissionHeight":1,"evolutionSpeed":8,"landFreq":14.1,"sealevel":0.08,"sealevelLayerDelta":-0.3,"rotationFreq":28,"rotationMag":0.69,"angularRotSpeed":0,"visibility":"mul","randomSeed":true,"layerColours":false,"roundedPoints":true,"lockAxes":false,"scalePoints":true,"showText":true,"line1":"Defining the future of","line2":"business solutions.","preset":"none","resolution":[2880,1580,1.8227848101265822]}'},Je={rotationSpeed:.8,dirChangeFreq:.01,dirChangeStrength:.01,dirChangeVariance:0,layers:3,sampleRadius:.01,layerStepDistance:.2,layerOpacityDelta:.5,pointSize:.5,opacity:1,emissionFreq:2,emissionSpeed:4.3,emissionStart:1,emissionEnd:-.7,emissionHeight:1,evolutionSpeed:8,landFreq:14.1,sealevel:.08,sealevelLayerDelta:-.3,rotationFreq:28,rotationMag:.69,angularRotSpeed:0,visibility:"mul",randomSeed:!0,layerColours:!1,roundedPoints:!0,lockAxes:!1,scalePoints:!0,showText:!0,line1:"Defining the future of",line2:"business solutions.",preset:"none",resolution:[2157,1079,2157/1079]};function _(n,e){for(let t in e)typeof e[t]=="object"?_(n[t],e[t]):n[t]=e[t]}var X=10,de=[34/255.99,46/255.99,55/255.99],$e=.02,Ke=.1,ce=[y.normalise([1,1,0]),y.normalise([1,-1,-1]),y.normalise([-1,1,0]),y.normalise([0,1,-1]),y.normalise([1,0,1])],Qe=[.27478805808024576,.7651830778546598,.09990401387135628,.5521414685809944,.8017688214506036],ee=class{controls=JSON.parse(JSON.stringify(Je));controlSource=null;controlTarget=null;controlTime=0;valid;canvasId;canvas;gl;width=0;height=0;planePoints=null;points=null;rotations=[];programs=[];ctx=[];overlay=document.getElementById("overlay");line1=document.getElementById("line1");line2=document.getElementById("line2");rnd={gen:Z(18284.480873),random:(e,t)=>Q(e,t,this.rnd.gen.double())};load(e){_(this.controls,JSON.parse(oe[e])),this.rebuild();let r=this.gl.canvas.getBoundingClientRect(),i=Math.round(r.width),s=Math.round(r.height),o=window.devicePixelRatio,u=Math.round(o*i),b=Math.round(o*s);this.width=u,this.height=b,this.gl.viewport(0,0,this.width,this.height);let f=h.mul(h.makeIdentity(),h.lookAt([0,0,5],[0,0,0],[0,1,0]),h.makeRotation([1,0,0],Math.PI/2));this.ctx[0].mvp.value=h.mul(h.makeIdentity(),h.makePerspective(45,this.width/this.height,.5,5),f),this.gl.useProgram(this.programs[0]),H(this.gl,this.ctx[0])}rebuild(e=!1){if(this.points!=null&&(this.gl.deleteVertexArray(this.points[0]),this.gl.deleteBuffer(this.points[1])),this.planePoints!=null&&(this.gl.deleteVertexArray(this.planePoints[0]),this.gl.deleteBuffer(this.planePoints[1])),this.points=Le(this.gl,this.controls.sampleRadius),this.points==null)return;let t=Math.floor(this.width/32),r=Math.floor(this.height/32);this.planePoints=Ve(this.gl,t,r),this.rotAccum.fill(0),this.rotations=ce.slice(0,this.controls.layers).map(i=>new y(i)),this.source=ce.slice(0,this.controls.layers).map(i=>new y(i)),this.targets=ce.slice(0,this.controls.layers).map(i=>new y(i)),this.rotAccum=new Array(this.controls.layers).fill(0),this.freq=new Array(this.controls.layers).fill(this.controls.dirChangeFreq),this.introTime=e?X:0,this.line1!=null&&(this.line1.innerText=this.controls.line1),this.line2!=null&&(this.line2.innerText=this.controls.line2),this.overlay!=null&&this.overlay.classList.contains("hidden")===this.controls.showText&&this.overlay.classList.toggle("hidden"),this.time=0,this.angle=0,this.rnd={gen:Z(18284.480873),random:(i,s)=>Q(i,s,this.rnd.gen.double())}}buildShaders(){let e=this.gl;this.programs=new Array(2);let t=be(e,Me,Se);typeof t=="string"?console.error("Compile Error:",t):(this.programs[0]=t,e.useProgram(t),this.ctx[0]=me(e,t),this.ctx[0].mvp.value=h.mul(h.makeIdentity(),h.makePerspective(45,1,.5,5),h.lookAt([0,0,5],[0,0,0],[0,1,0])),this.ctx[0].pointSize.value=this.controls.pointSize,H(e,this.ctx[0]));let r=be(e,ke,we);typeof r=="string"?console.error("Compile Error:",r):(this.programs[1]=r,e.useProgram(r),this.ctx[1]=me(e,r),this.ctx[1].mvp.value=h.mul(h.makeIdentity(),h.makePerspective(45,1,.5,5),h.lookAt([0,0,2],[0,0,0],[0,1,0])),this.ctx[1].pointSize.value=this.controls.pointSize,H(e,this.ctx[1]))}constructor(e,t=!1){if(this.valid=document.getElementById(e)!=null,!this.valid)return;this.canvasId=e;let r=document.getElementById(e);this.canvas=r;let i=r.getContext("webgl2");if(i==null)throw new Error("WebGL2 not supported");switch(this.gl=i,i.enable(i.DEPTH_TEST),window.addEventListener("resize",()=>{this.onResize()}),i.clearColor(de[0],de[1],de[2],1),this.buildShaders(),this.onResize(),e){case"canvas":_(this.controls,JSON.parse(oe.base)),this.rebuild(t);break;case"accordion-canvas":_(this.controls,JSON.parse(oe.ai)),this.rebuild(t);break;case"about-canvas":_(this.controls,JSON.parse(oe.about)),this.rebuild(t);break}}onResize(){if(this.gl.canvas==null||this.ctx==null)return;let e=this.gl.canvas,t=e.getBoundingClientRect(),r=Math.round(t.width),i=Math.round(t.height),s=window.devicePixelRatio,o=Math.round(s*r),u=Math.round(s*i);if(this.width!==o||this.height!==u){this.width=o,this.height=u,e.width=this.width,e.height=this.height,this.gl.viewport(0,0,this.width,this.height),console.log(this.canvasId,this.width,this.height,t);let b=h.mul(h.makeIdentity(),h.lookAt([0,0,5],[0,0,0],[0,1,0]),h.makeRotation([1,0,0],Math.PI/2));this.ctx[0].mvp.value=h.mul(h.makeIdentity(),h.makePerspective(45,this.width/this.height,.5,5),b),this.gl.useProgram(this.programs[0]),H(this.gl,this.ctx[0])}}angle=0;source=[];targets=[];rotAccum=[];freq=[];time=0;introTime=X;render(e){if(this.ctx==null)return;let t=this.gl;t.viewport(0,0,this.width,this.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.time+=e;let r=(X-this.introTime)/X,i=Q(0,1,r>.8?(r-.8)/.2:0),s=1-i;this.introTime>0&&(this.introTime-=e,this.renderIntro(s)),t.useProgram(this.programs[0]),this.angle+=this.controls.rotationSpeed*.1*e,this.ctx[0].speeds.value=[this.controls.emissionSpeed*$e,this.controls.evolutionSpeed*Ke,this.controls.angularRotSpeed,0];let o=this.width/this.controls.resolution[0],u=this.height/this.controls.resolution[1],b=Math.sqrt(o*o+u*u);this.ctx[0].pointSize.value=this.controls.pointSize*b;let f=(a=1)=>new y(this.rnd.random(-1,1),this.rnd.random(-1,1),this.rnd.random(-1,1)).mulScalar(a);(!this.rotAccum||!this.freq||!this.source||!this.targets)&&(this.rotAccum=new Array(this.controls.layers).fill(0),this.freq=new Array(this.controls.layers).fill(this.controls.dirChangeFreq),this.source=new Array(this.controls.layers).fill(new y(0,1,0)),this.targets=new Array(this.controls.layers).fill(new y(0,1,0)));for(let a=0;a<this.controls.layers;++a)this.rotAccum[a]-=e,this.rotAccum[a]<=0&&(this.freq[a]=this.rnd.random(this.controls.dirChangeFreq*(1-this.controls.dirChangeVariance),this.controls.dirChangeFreq),this.rotAccum[a]=1/this.freq[a],this.source[a]=new y(this.rotations[a]),this.targets[a]=new y(f(this.controls.dirChangeStrength).add(this.rotations[a])).normalise());(!this.rotAccum||!this.freq||!this.source||!this.targets)&&(this.rotAccum=new Array(this.controls.layers).fill(0),this.freq=new Array(this.controls.layers).fill(this.controls.dirChangeFreq),this.source=new Array(this.controls.layers).fill(new y(0,1,0)),this.targets=new Array(this.controls.layers).fill(new y(0,1,0)));for(let a=0;a<this.controls.layers;++a){console.log("i:",a,this.rotAccum[a],this.freq[a],this.source[a],this.targets[a],this.rotations[a]);let x=1-this.rotAccum[a]*this.freq[a];Ae(this.source[a],this.targets[a],this.rotations[a],re(0,1,x)),this.rotations[a].normalise()}this.ctx[0].time.value=this.time,this.ctx[0].opacity.value=Math.min(this.controls.opacity,i),this.ctx[0].scalePoints.value=this.controls.scalePoints?1:0,this.ctx[0].frequencies.value=[this.controls.emissionFreq,this.controls.landFreq,this.controls.rotationFreq,this.controls.rotationMag];let d=this.width<this.height?this.width/this.height:1;for(let a=0;a<this.controls.layers;++a){let x=h.mul(h.makeIdentity(),this.controls.lockAxes?h.makeRotation(ce[a],this.angle*(a%2===0?-1:1)):h.makeRotation(this.rotations[a],this.angle*(a%2===0?-1:1)),h.mul(h.makeIdentity(),h.makeRotation([1,0,0],Math.PI/2),h.makeScale([d*(1-a*this.controls.layerStepDistance),d*(1-a*this.controls.layerStepDistance),d*(1-a*this.controls.layerStepDistance)]))),g=h.mul(h.makeIdentity(),h.lookAt([0,0,3],[0,0,0],[0,1,0]),x);this.ctx[0].mv.value=g,this.ctx[0].mvp.value=h.mul(h.makeIdentity(),h.makePerspective(45,this.width/this.height,.5,5),g);let L=q(1-this.controls.layerOpacityDelta*a,0,1),A=5-3*(a/this.controls.layers);this.ctx[0].layerControls.value=[L,A,a,this.controls.layerColours?1:0],this.ctx[0].landmass.value=[this.controls.emissionStart,this.controls.emissionEnd,this.controls.emissionHeight,this.controls.sealevel+q(a*this.controls.sealevelLayerDelta,0,1)],this.ctx[0].roundedPoints.value=this.controls.roundedPoints?1:0,this.ctx[0].randomSeed.value=this.controls.randomSeed?Qe[a]:0,this.ctx[0].visibility.value=je.indexOf(this.controls.visibility),H(this.gl,this.ctx[0]),this.points!=null&&(t.bindVertexArray(this.points[0]),t.drawArrays(t.POINTS,0,this.points[2]))}}renderIntro(e){if(this.ctx==null||this.introTime<=0)return;let t=this.gl;t.viewport(0,0,this.width,this.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.useProgram(this.programs[1]);let r=this.width/this.controls.resolution[0],i=this.height/this.controls.resolution[1],s=Math.sqrt(r*r+i*i);this.ctx[1].pointSize.value=6*s,this.ctx[1].time.value=this.time,this.ctx[1].opacity.value=e;let o=1-this.introTime/X,u=re(0,.5,o)-re(.5,1,o),b=Q(3,1.5,u);this.ctx[1].resolution.value=[this.width,this.height,this.width/this.height];for(let f=0;f<5;++f)this.ctx[1].mvp.value=h.mul(h.makeIdentity(),h.makePerspective(45,this.width/this.height,.5,5),h.mul(h.makeIdentity(),h.lookAt([0,0,b],[0,0,0],[0,1,0]),h.makeScale([1-.15*f,1-.15*f,1-.15*f]))),this.ctx[1].layer.value=f,H(t,this.ctx[1]),this.planePoints!=null&&(t.bindVertexArray(this.planePoints[0]),t.drawArrays(t.POINTS,0,this.planePoints[2]))}},ae=new ee("canvas",!0),ue=new ee("about-canvas",!1),I=[null,null];ae.valid&&(I[0]=ae);ue.valid&&(I[1]=ue);var fe=[!0,!0],Pe=performance.now(),pe=performance.now(),Ce=1,Te=()=>{Pe=pe,pe=performance.now(),Ce=(pe-Pe)*.001,I.forEach((n,e)=>{fe[e]&&n?.render(Ce)}),window.requestAnimationFrame(Te)};window.requestAnimationFrame(Te);var Ie=["ai-accordion","b2b-accordion","ct-accordion"],Ze=["ai","b2b","clean"],Xe=[];function _e(n){let e=document.getElementById(n);if(!e)return;let t=performance.now(),r=new MutationObserver(i=>{i.forEach(s=>{(s.type==="childList"||s.type==="attributes")&&performance.now()-t>500&&(ae?.load(Ze[Ie.indexOf(n)]),t=performance.now())})});r.observe(e,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["style"]}),Xe.push(r)}Ie.forEach(_e);var le=new IntersectionObserver(n=>{n.forEach(e=>{if(e.isIntersecting){let t=I.findIndex(r=>r?.canvasId===e.target.id);fe[t]=!0}else{let t=I.findIndex(r=>r?.canvasId===e.target.id);fe[t]=!1}})},{threshold:.1});le.observe(ae.canvas);ue.valid&&le.observe(ue.canvas);function De(n,e){return n.classList?.contains("main")&&n.querySelector!=null&&n.querySelector(e)}function Re(n,e,t){De(n,e)&&(I[t]=new ee(e.slice(1),!1),le.observe(I[t]?.canvas))}function Fe(n,e,t){De(n,e)&&(I[t]&&le.unobserve(I[t]?.canvas),I[t]=null)}var et=new MutationObserver(n=>{n.forEach(e=>{e.addedNodes.forEach(t=>{Re(t,"#canvas",0),Re(t,"#about-canvas",1)}),e.removedNodes.forEach(t=>{Fe(t,"#canvas",0),Fe(t,"#about-canvas",1)})})});et.observe(document.body,{childList:!0,subtree:!0});export{ee as RenderApp};
