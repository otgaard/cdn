var y=class r extends Float32Array{static size=3;constructor(e,t,n){super(r.size),this.set(e??0,t,n)}static fromBuffer(e,t){return new Float32Array(e,t,3)}static create(){return new r}clone(){return new r(this)}put(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this}set(e,t,n){return typeof e=="number"?(this[0]=e,this[1]=t??e,this[2]=n??e):super.set(e),this}static set(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e}copy(e){return this.set(e),this}static copy(e,t){return e.set(t),e}add(e){return this[0]+=e[0],this[1]+=e[1],this[2]+=e[2],this}static add(e,t,n){return n=n??new r,n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}addScalar(e){return this[0]+=e,this[1]+=e,this[2]+=e,this}static addScalar(e,t,n){return n=n??new r,n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t,n}addScaled(e,t){return this[0]+=e[0]*t,this[1]+=e[1]*t,this[2]+=e[2]*t,this}sub(e){return this[0]-=e[0],this[1]-=e[1],this[2]-=e[2],this}static sub(e,t,n){return n=n??new r,n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}subScalar(e){return this[0]-=e,this[1]-=e,this[2]-=e,this}static subScalar(e,t,n){return n=n??new r,n[0]-=t,n[1]-=t,n[2]-=t,n}mul(e){return this[0]*=e[0],this[1]*=e[1],this[2]*=e[2],this}static mul(e,t,n){return n=n??new r,n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}mulScalar(e){return this[0]*=e,this[1]*=e,this[2]*=e,this}static mulScalar(e,t,n){return n=n??new r,n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}div(e){return this[0]/=e[0],this[1]/=e[1],this[2]/=e[2],this}static div(e,t,n){return n=n??new r,n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n}divScalar(e){return this[0]/=e,this[1]/=e,this[2]/=e,this}static divScalar(e,t,n){return n=n??new r,n[0]=e[0]/t,n[1]=e[1]/t,n[2]=e[2]/t,n}dot(e){return this.x*e[0]+this.y*e[1]+this.z*e[2]}static dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}dotScalar(e,t,n){return this.x*e+this.y*t+this.z*n}static dotScalar(e,t,n,i){return e[0]*t+e[1]*n+e[2]*i}normalise(){return this.mulScalar(1/this.len())}static normalise(e){if(Array.isArray(e)||e instanceof Float32Array){let t=1/r.len(e);for(let n=0;n!==3;++n)e[n]*=t;return e}else if(e instanceof r)return e.mulScalar(1/e.len())}cross(e){let t=this.x,n=this.y,i=this.z;return this.x=n*e[2]-i*e[1],this.y=i*e[0]-t*e[2],this.z=t*e[1]-n*e[0],this}static cross(e,t,n){return n=n??new r,n[0]=e[1]*t[2]-e[2]*t[1],n[1]=e[2]*t[0]-e[0]*t[2],n[2]=e[0]*t[1]-e[1]*t[0],n}static crossF(e,t,n,i){e[t]=n[1]*i[2]-n[2]*i[1],e[t+1]=n[2]*i[0]-n[0]*i[2],e[t+2]=n[0]*i[1]-n[1]*i[0]}lenSq(){return this.dot(this)}static lenSq(e){return r.dot(e,e)}len(){return Math.sqrt(this.lenSq())}static len(e){return Math.sqrt(r.dot(e,e))}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}};var J=["POSITION","TEXCOORD0","TEXCOORD1","NORMAL","BITANGENT","TANGENT","COLOUR0","COLOUR1"];var he=Math.PI,At=2*he,Lt=he/2;function P(r,e,t=1e-6){return Math.abs(r-e)<t}function I(r,e,t){return r<e?e:r>t?t:r}function q(r,e,t){return t=I((t-r)/(e-r),0,1),t*t*(3-2*t)}function D(r,e,t){return(1-t)*r+t*e}function be(r,e,t,n){let i=1-n;for(let s=0;s!==t.length;++s)t[s]=i*r[s]+n*e[s]}var w=class r extends Float32Array{static size=2;constructor(e,t){super(r.size),this.set(e??0,t??(typeof e=="number"?e:void 0))}static create(){return new r}clone(){return new r(this)}put(e,t){return this[0]=e,this[1]=t,this}set(e,t){return typeof e=="number"?(this[0]=e,this[1]=t??e):super.set(e),this}static set(e,t,n){return e[0]=t,e[1]=n,e}copy(e){return this.set(e),this}static copy(e,t){return e.set(t),e}add(e){return this[0]+=e[0],this[1]+=e[1],this}static add(e,t,n){return n=n??new r,n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}addScalar(e){return this[0]+=e,this[1]+=e,this}static addScalar(e,t,n){return n=n??new r,n[0]=e[0]+t,n[1]=e[1]+t,n}addScaled(e,t){return this[0]+=e[0]*t,this[1]+=e[1]*t,this}static addScaled(e,t,n,i){return i=i??new r,i[0]=e[0]+t[0]*n,i[1]=e[1]+t[1]*n,i}sub(e){return this[0]-=e[0],this[1]-=e[1],this}static sub(e,t,n){return n=n??new r,n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}subScalar(e){return this[0]-=e,this[1]-=e,this}static subScalar(e,t,n){return n=n??new r,n[0]-=t,n[1]-=t,n}mul(e){return this[0]*=e[0],this[1]*=e[1],this}static mul(e,t,n){return n=n??new r,n[0]=e[0]*t[0],n[1]=e[1]*t[1],n}mulScalar(e){return this[0]*=e,this[1]*=e,this}static mulScalar(e,t,n){return n=n??new r,n[0]=e[0]*t,n[1]=e[1]*t,n}div(e){return this[0]/=e[0],this[1]/=e[1],this}static div(e,t,n){return n=n??new r,n[0]=e[0]/t[0],n[1]=e[1]/t[1],n}divScalar(e){return this[0]/=e,this[1]/=e,this}static divScalar(e,t,n){return n=n??new r,n[0]=e[0]/t,n[1]=e[1]/t,n}dot(e){return this.x*e[0]+this.y*e[1]}static dot(e,t){return e[0]*t[0]+e[1]*t[1]}static perp(e){return new r(-e.y,e.x)}dotScalar(e,t){return this.x*e+this.y*t}static dotScalar(e,t,n){return e[0]*t+e[1]*n}normalise(){return this.mulScalar(1/this.len)}static normalise(e){if(Array.isArray(e)||e instanceof Float32Array){let t=1/r.len(e);return e[0]*=t,e[1]*=t,e}else if(e instanceof r)return e.mulScalar(1/e.len)}static kross(e,t){return e[0]*t[1]-e[1]*t[0]}static reflect(e,t){let n=2*r.dot(e,t),i=r.mulScalar(t,n);return r.sub(e,i)}clamp(e,t){return this.x=I(this.x,e,t),this.y=I(this.x,e,t),this}apply(e){return this.x=e(this.x),this.y=e(this.y),this}static distSq(e,t){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}static dist(e,t){return Math.sqrt(r.distSq(e,t))}lenSq(){return this.dot(this)}static lenSq(e){return r.dot(e,e)}get len(){return Math.sqrt(this.lenSq())}static len(e){return Math.sqrt(r.dot(e,e))}invert(){return this.x=1/this.x,this.y=1/this.y,this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}};function De(r,e,t){let n=t&&t.state;n&&(typeof n=="object"&&e.copy(n,e),r.state=()=>e.copy(e,{}))}function Ne(r,e){let t=()=>(r.next()>>>0)/4294967296;return t.double=()=>{let n,i,s;do n=r.next()>>>11,i=(r.next()>>>0)/4294967296,s=(n+i)/(1<<21);while(s===0);return s},t.int32=()=>r.next()|0,t.quick=t,De(t,r,e),t}var X=Be;function Be(r,e){let t=new ne(r);return Ne(t,e)}var ne=class{constructor(e){e==null&&(e=+new Date);let t="";this.x=0,this.y=0,this.z=0,this.w=0,e===(e|0)?this.x=e:t+=e;for(let n=0;n<t.length+64;n++)this.x^=t.charCodeAt(n)|0,this.next()}next(){let{x:e,y:t,z:n,w:i}=this,s=e^e<<11;return this.x=t,this.y=n,this.z=i,this.w=i^(i>>>19^s^s>>>8)}copy(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}};var N=class r extends Float32Array{static size=4;constructor(e,t,n,i){super(r.size),this.set(e??0,t,n,i)}static create(){return new r}clone(){return new r(this)}put(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this}set(e,t,n,i){return typeof e=="number"?(this[0]=e,this[1]=t??e,this[2]=n??e,this[3]=i??e):super.set(e),this}static set(e,t,n,i,s){return e[0]=t,e[1]=n,e[2]=i,e[3]=s,e}copy(e){return this.set(e),this}static copy(e,t){return e.set(t),e}add(e){return this[0]+=e[0],this[1]+=e[1],this[2]+=e[2],this[3]+=e[3],this}static add(e,t,n){return n=n??new r,n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}addScalar(e){return this[0]+=e,this[1]+=e,this[2]+=e,this[3]+=e,this}static addScalar(e,t,n){return n=n??new r,n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t,n[3]=e[3]+t,n}sub(e){return this[0]-=e[0],this[1]-=e[1],this[2]-=e[2],this[3]-=e[3],this}static sub(e,t,n){return n=n??new r,n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n}subScalar(e){return this[0]-=e,this[1]-=e,this[2]-=e,this[3]-=e,this}static subScalar(e,t,n){return n=n??new r,n[0]-=t,n[1]-=t,n[2]-=t,n[3]-=t,n}mul(e){return this[0]*=e[0],this[1]*=e[1],this[2]*=e[2],this[3]*=e[3],this}static mul(e,t,n){return n=n??new r,n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n[3]=e[3]*t[3],n}mulScalar(e){return this[0]*=e,this[1]*=e,this[2]*=e,this[3]*=e,this}static mulScalar(e,t,n){return n=n??new r,n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}madd(e,t,n){return typeof e=="number"?(this[0]=this[0]*t+e,this[1]=this[1]*t+e,this[2]=this[2]*t+e,this[3]=this[3]*t+e):(this[0]=this[0]*t+e[0],this[1]=this[1]*t+e[1],this[2]=this[2]*t+e[2],this[3]=this[3]*t+e[3]),this}div(e){return this[0]/=e[0],this[1]/=e[1],this[2]/=e[2],this[3]/=e[3],this}static div(e,t,n){return n=n??new r,n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n[3]=e[3]/t[3],n}divScalar(e){return this[0]/=e,this[1]/=e,this[2]/=e,this[3]/=e,this}static divScalar(e,t,n){return n=n??new r,n[0]=e[0]/t,n[1]=e[1]/t,n[2]=e[2]/t,n[3]=e[3]/t,n}dot(e){return this.x*e[0]+this.y*e[1]+this.z*e[2]+this.w*e[3]}static dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}dotScalar(e,t,n,i){return this.x*e+this.y*t+this.z*n+this.w*i}static dotScalar(e,t,n,i,s){return e[0]*t+e[1]*n+e[2]*i+e[3]*s}normalise(){return this.mulScalar(1/this.len())}static normalise(e){if(Array.isArray(e)||e instanceof Float32Array){let t=1/r.len(e);for(let n=0;n!==4;++n)e[n]*=t;return e}else if(e instanceof r)return e.mulScalar(1/e.len())}lenSq(){return this.dot(this)}static lenSq(e){return r.dot(e,e)}len(){return Math.sqrt(this.lenSq())}static len(e){return Math.sqrt(r.dot(e,e))}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}get w(){return this[3]}set w(e){this[3]=e}};function Ge(r,e,t){let n=r.createShader(t);return n==null?"Failed to create shader":(e.includes("#version")||(e=`#version 300 es
${e}`),r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)===!1?`Failed to create shader with error:
${r.getShaderInfoLog(n)??"unknown"}`:n)}function K(r,e,t,n=!0,i){let s=[[e,r.VERTEX_SHADER,"vertex"],[t,r.FRAGMENT_SHADER,"fragment"]];i=i??[];let o=r.createProgram();if(o==null)return"Failed to create shader program";for(let a=0;a!==s.length;++a){if(typeof s[a][0]!="string"){r.attachShader(o,s[a][0]);continue}let b=Ge(r,s[a][0],s[a][1]);if(typeof b=="string")return console.error(b,s[a][0]),r.deleteProgram(o),b;r.attachShader(o,b),i.push(b)}if(r.linkProgram(o),n&&i.forEach(a=>{r.deleteShader(a)}),r.getProgramParameter(o,r.LINK_STATUS)===!0)return o;{let a=r.getProgramInfoLog(o)??"unknown";return r.deleteProgram(o),`Failed to create program with error:
${a}`}}var v=class r extends Float32Array{static size=9;constructor(){super(r.size)}static create(e){let t=new r;return e!=null&&t.set(e),t}static idx(e,t){return 3*t+e}static set(e,t,n,i){e[r.idx(t,n)]=i}static get(e,t,n){return e[r.idx(t,n)]}static fromMat4Rotation(e){let t=r.create();return r.setColumn(t,0,l.getColumn(e,0)),r.setColumn(t,1,l.getColumn(e,1)),r.setColumn(t,2,l.getColumn(e,2)),t}copyMat4Rotation(e){return r.setColumn(this,0,l.getColumn(e,0)),r.setColumn(this,1,l.getColumn(e,1)),r.setColumn(this,2,l.getColumn(e,2)),this}static getColumn(e,t){return[e[r.idx(0,t)],e[r.idx(1,t)],e[r.idx(2,t)]]}static setColumn(e,t,n){e[r.idx(0,t)]=n[0],e[r.idx(1,t)]=n[1],e[r.idx(2,t)]=n[2]??(t===2?1:0)}static makeTranslation(e,t){let n=r.makeIdentity();return n[r.idx(0,2)]=e,n[r.idx(1,2)]=t,n}static translate(e,t,n){if(typeof n=="number")e[r.idx(0,2)]=t,e[r.idx(1,2)]=n;else{let i=t;e[r.idx(0,2)]=i[0],e[r.idx(1,2)]=i[1]}return e}static makeIdentity(){let e=r.create();return e[r.idx(0,0)]=1,e[r.idx(1,1)]=1,e[r.idx(2,2)]=1,e}static makeRotation(e){let[t,n]=[Math.cos(e),Math.sin(e)],i=r.create();return r.set(i,0,0,t),r.set(i,0,1,-n),r.set(i,1,0,n),r.set(i,1,1,t),r.set(i,2,2,1),i}static makeRotation3(e,t){P(y.len(e),1)||(console.log("Warning, input axis to makeRotation should be unit length"),y.normalise(e));let[n,i,s]=[Math.cos(t),Math.sin(t),1-Math.cos(t)],[o,a,b]=[s*e[0],s*e[1],s*e[2]],[p,f,x]=[i*e[0],i*e[1],i*e[2]],[c,h,L]=[o*e[1],a*e[2],o*e[2]],d=r.create();return r.set(d,0,0,o*e[0]+n),r.set(d,0,1,c+x),r.set(d,0,2,L-f),r.set(d,1,0,c-x),r.set(d,1,1,a*e[1]+n),r.set(d,1,2,h+p),r.set(d,2,0,L+f),r.set(d,2,1,h-p),r.set(d,2,2,b*e[2]+n),d}static rotate(e,t){let[n,i]=[Math.cos(t),Math.sin(t)];return r.set(e,0,0,n),r.set(e,0,1,-i),r.set(e,1,0,i),r.set(e,1,1,n),r.set(e,2,2,1),e}static makeScale(e){let t=typeof e=="number",n=r.create();return r.set(n,0,0,t?e:e[0]),r.set(n,1,1,t?e:e[1]),r.set(n,2,2,1),n}static scale(e,t){return r.set(e,0,0,t[0]),r.set(e,1,1,t[1]),r.set(e,2,2,1),e}static scaleBy(e,t){return r.set(e,0,0,r.get(e,0,0)*t[0]),r.set(e,0,1,r.get(e,0,1)*t[1]),r.set(e,1,0,r.get(e,1,0)*t[0]),r.set(e,1,1,r.get(e,1,1)*t[1]),e}static makeTransform(e,t,n){let i=r.create();return r.set(i,0,0,t[0]*Math.cos(n)),r.set(i,0,1,-t[1]*Math.sin(n)),r.set(i,1,0,t[0]*Math.sin(n)),r.set(i,1,1,t[1]*Math.cos(n)),r.set(i,0,2,e[0]),r.set(i,1,2,e[1]),r.set(i,2,2,1),i}mul2(e){let t=e[0],n=e[1];return e[0]=r.get(this,0,0)*t+r.get(this,0,1)*n,e[1]=r.get(this,1,0)*t+r.get(this,1,1)*n,e}transform2(e){let t=e[0],n=e[1];return e[0]=r.get(this,0,0)*t+r.get(this,0,1)*n+r.get(this,0,2),e[1]=r.get(this,1,0)*t+r.get(this,1,1)*n+r.get(this,1,2),e}static transform2(e,t,n,i){let s=t[0],o=t[1],a=i??0;return n[a]=r.get(e,0,0)*s+r.get(e,0,1)*o+r.get(e,0,2),n[a+1]=r.get(e,1,0)*s+r.get(e,1,1)*o+r.get(e,1,2),n}static mul(e,t,n){return r.set(e,0,0,r.get(t,0,0)*r.get(n,0,0)+r.get(t,0,1)*r.get(n,1,0)+r.get(t,0,2)*r.get(n,2,0)),r.set(e,0,1,r.get(t,0,0)*r.get(n,0,1)+r.get(t,0,1)*r.get(n,1,1)+r.get(t,0,2)*r.get(n,2,1)),r.set(e,0,2,r.get(t,0,0)*r.get(n,0,2)+r.get(t,0,1)*r.get(n,1,2)+r.get(t,0,2)*r.get(n,2,2)),r.set(e,1,0,r.get(t,1,0)*r.get(n,0,0)+r.get(t,1,1)*r.get(n,1,0)+r.get(t,1,2)*r.get(n,2,0)),r.set(e,1,1,r.get(t,1,0)*r.get(n,0,1)+r.get(t,1,1)*r.get(n,1,1)+r.get(t,1,2)*r.get(n,2,1)),r.set(e,1,2,r.get(t,1,0)*r.get(n,0,2)+r.get(t,1,1)*r.get(n,1,2)+r.get(t,1,2)*r.get(n,2,2)),r.set(e,2,0,r.get(t,2,0)*r.get(n,0,0)+r.get(t,2,1)*r.get(n,1,0)+r.get(t,2,2)*r.get(n,2,0)),r.set(e,2,1,r.get(t,2,0)*r.get(n,0,1)+r.get(t,2,1)*r.get(n,1,1)+r.get(t,2,2)*r.get(n,2,1)),r.set(e,2,2,r.get(t,2,0)*r.get(n,0,2)+r.get(t,2,1)*r.get(n,1,2)+r.get(t,2,2)*r.get(n,2,2)),e}static inverse(e,t=1e-4){let n=r.create();n[0]=e[4]*e[8]-e[5]*e[7],n[1]=e[2]*e[7]-e[1]*e[8],n[2]=e[1]*e[5]-e[2]*e[4],n[3]=e[5]*e[6]-e[3]*e[8],n[4]=e[0]*e[8]-e[2]*e[6],n[5]=e[2]*e[3]-e[0]*e[5],n[6]=e[3]*e[7]-e[4]*e[6],n[7]=e[1]*e[6]-e[0]*e[7],n[8]=e[0]*e[4]-e[1]*e[3];let i=e[0]*n[0]+e[1]*n[3]+e[2]*n[6];if(Math.abs(i)>t){let s=1/i;return n[0]*=s,n[1]*=s,n[2]*=s,n[3]*=s,n[4]*=s,n[5]*=s,n[6]*=s,n[7]*=s,n[8]*=s,n}return r.create()}static transpose(e){let t=r.idx,n=e[t(0,1)];return e[t(0,1)]=e[t(1,0)],e[t(1,0)]=n,n=e[t(0,2)],e[t(0,2)]=e[t(2,0)],e[t(2,0)]=n,n=e[t(1,2)],e[t(1,2)]=e[t(2,1)],e[t(2,1)]=n,e}};var l=class r extends Float32Array{static size=16;constructor(){super(r.size)}static create(e){let t=new r;return e!=null&&t.set(e),t}static fromMat3(e){let t=r.makeIdentity();return r.set(t,0,0,v.get(e,0,0)),r.set(t,0,1,v.get(e,0,1)),r.set(t,0,3,v.get(e,0,2)),r.set(t,1,0,v.get(e,1,0)),r.set(t,1,1,v.get(e,1,1)),r.set(t,1,3,v.get(e,1,2)),t}static idx(e,t){return 4*t+e}static set(e,t,n,i){e[r.idx(t,n)]=i}static get(e,t,n){return e[r.idx(t,n)]}static makePerspective(e,t,n,i){let s=r.create(),o=Math.tan(e*Math.PI/360);return s[r.idx(0,0)]=1/(t*o),s[r.idx(1,1)]=1/o,s[r.idx(2,2)]=-(i+n)/(i-n),s[r.idx(2,3)]=-(2*n*i)/(i-n),s[r.idx(3,2)]=-1,s}static getColumn(e,t){return[e[r.idx(0,t)],e[r.idx(1,t)],e[r.idx(2,t)],e[r.idx(3,t)]]}static setColumn(e,t,n){e[r.idx(0,t)]=n[0],e[r.idx(1,t)]=n[1],e[r.idx(2,t)]=n[2],e[r.idx(3,t)]=n[3]??(t===3?1:0)}static makeOrtho(e,t,n,i,s,o){let a=1/(e-t),b=1/(n-i),p=1/(s-o),f=r.create();return f[0]=-2*a,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*b,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*p,f[11]=0,f[12]=(e+t)*a,f[13]=(i+n)*b,f[14]=(o+s)*p,f[15]=1,f}static makeTranslation(e,t,n){let i=r.makeIdentity();return i[r.idx(0,3)]=e,i[r.idx(1,3)]=t,i[r.idx(2,3)]=n,i}static makeXAxisReflection(){let e=r.makeIdentity();return e[r.idx(0,0)]=-1,e}static makeYAxisReflection(){let e=r.makeIdentity();return e[r.idx(1,1)]=-1,e}static makeZAxisReflection(){let e=r.makeIdentity();return e[r.idx(2,2)]=-1,e}static translate(e,t,n,i){return typeof t=="number"?(e[r.idx(0,3)]=t,e[r.idx(1,3)]=n??0,e[r.idx(2,3)]=i??0):(e[r.idx(0,3)]=t[0],e[r.idx(1,3)]=t[1],e[r.idx(2,3)]=t[2]),e}static makeIdentity(){let e=r.create();return e[r.idx(0,0)]=1,e[r.idx(1,1)]=1,e[r.idx(2,2)]=1,e[r.idx(3,3)]=1,e}static makeRotation(e,t){P(y.len(e),1)||(console.log("Warning, input axis to makeRotation should be unit length"),y.normalise(e));let[n,i,s]=[Math.cos(t),Math.sin(t),1-Math.cos(t)],[o,a,b]=[s*e[0],s*e[1],s*e[2]],[p,f,x]=[i*e[0],i*e[1],i*e[2]],[c,h,L]=[o*e[1],a*e[2],o*e[2]],d=r.create();return r.set(d,0,0,o*e[0]+n),r.set(d,0,1,c+x),r.set(d,0,2,L-f),r.set(d,1,0,c-x),r.set(d,1,1,a*e[1]+n),r.set(d,1,2,h+p),r.set(d,2,0,L+f),r.set(d,2,1,h-p),r.set(d,2,2,b*e[2]+n),r.set(d,3,3,1),d}static rotate(e,t,n){P(y.len(t),1)||(console.log("Warning, input axis to makeRotation should be unit length"),y.normalise(t));let[i,s,o]=[Math.cos(n),Math.sin(n),1-Math.cos(n)],[a,b,p]=[o*t[0],o*t[1],o*t[2]],[f,x,c]=[s*t[0],s*t[1],s*t[2]],[h,L,d]=[a*t[1],b*t[2],a*t[2]];return r.set(e,0,0,a*t[0]+i),r.set(e,0,1,h+c),r.set(e,0,2,d-x),r.set(e,1,0,h-c),r.set(e,1,1,b*t[1]+i),r.set(e,1,2,L+f),r.set(e,2,0,d+x),r.set(e,2,1,L-f),r.set(e,2,2,p*t[2]+i),e}static setRot(e,t,n){return r.set(e,0,0,v.get(t,0,0)),r.set(e,0,1,v.get(t,0,1)),r.set(e,0,2,v.get(t,0,2)),r.set(e,1,0,v.get(t,1,0)),r.set(e,1,1,v.get(t,1,1)),r.set(e,1,2,v.get(t,1,2)),r.set(e,2,0,v.get(t,2,0)),r.set(e,2,1,v.get(t,2,1)),r.set(e,2,2,v.get(t,2,2)),e}static setRotScale(e,t,n){return r.set(e,0,0,n.x*v.get(t,0,0)),r.set(e,0,1,n.y*v.get(t,0,1)),r.set(e,0,2,n.z*v.get(t,0,2)),r.set(e,1,0,n.x*v.get(t,1,0)),r.set(e,1,1,n.y*v.get(t,1,1)),r.set(e,1,2,n.z*v.get(t,1,2)),r.set(e,2,0,n.x*v.get(t,2,0)),r.set(e,2,1,n.y*v.get(t,2,1)),r.set(e,2,2,n.z*v.get(t,2,2)),e}static makeScale(e){let t=typeof e=="number",n=r.create();return r.set(n,0,0,t?e:e[0]),r.set(n,1,1,t?e:e[1]),r.set(n,2,2,t?e:e[2]),r.set(n,3,3,1),n}static scale(e,t){return r.set(e,0,0,t[0]),r.set(e,1,1,t[1]),r.set(e,2,2,t[2]),e}static makeTransform(e,t,n){let i=r.create();return r.rotate(i,[1,0,0],t[0]),r.rotate(i,[0,1,0],t[1]),r.rotate(i,[0,0,1],t[2]),r.scale(i,e),r.translate(i,n[0],n[1],n[2]),i}static mul(e,t,n){return r.set(e,0,0,r.get(t,0,0)*r.get(n,0,0)+r.get(t,0,1)*r.get(n,1,0)+r.get(t,0,2)*r.get(n,2,0)+r.get(t,0,3)*r.get(n,3,0)),r.set(e,0,1,r.get(t,0,0)*r.get(n,0,1)+r.get(t,0,1)*r.get(n,1,1)+r.get(t,0,2)*r.get(n,2,1)+r.get(t,0,3)*r.get(n,3,1)),r.set(e,0,2,r.get(t,0,0)*r.get(n,0,2)+r.get(t,0,1)*r.get(n,1,2)+r.get(t,0,2)*r.get(n,2,2)+r.get(t,0,3)*r.get(n,3,2)),r.set(e,0,3,r.get(t,0,0)*r.get(n,0,3)+r.get(t,0,1)*r.get(n,1,3)+r.get(t,0,2)*r.get(n,2,3)+r.get(t,0,3)*r.get(n,3,3)),r.set(e,1,0,r.get(t,1,0)*r.get(n,0,0)+r.get(t,1,1)*r.get(n,1,0)+r.get(t,1,2)*r.get(n,2,0)+r.get(t,1,3)*r.get(n,3,0)),r.set(e,1,1,r.get(t,1,0)*r.get(n,0,1)+r.get(t,1,1)*r.get(n,1,1)+r.get(t,1,2)*r.get(n,2,1)+r.get(t,1,3)*r.get(n,3,1)),r.set(e,1,2,r.get(t,1,0)*r.get(n,0,2)+r.get(t,1,1)*r.get(n,1,2)+r.get(t,1,2)*r.get(n,2,2)+r.get(t,1,3)*r.get(n,3,2)),r.set(e,1,3,r.get(t,1,0)*r.get(n,0,3)+r.get(t,1,1)*r.get(n,1,3)+r.get(t,1,2)*r.get(n,2,3)+r.get(t,1,3)*r.get(n,3,3)),r.set(e,2,0,r.get(t,2,0)*r.get(n,0,0)+r.get(t,2,1)*r.get(n,1,0)+r.get(t,2,2)*r.get(n,2,0)+r.get(t,2,3)*r.get(n,3,0)),r.set(e,2,1,r.get(t,2,0)*r.get(n,0,1)+r.get(t,2,1)*r.get(n,1,1)+r.get(t,2,2)*r.get(n,2,1)+r.get(t,2,3)*r.get(n,3,1)),r.set(e,2,2,r.get(t,2,0)*r.get(n,0,2)+r.get(t,2,1)*r.get(n,1,2)+r.get(t,2,2)*r.get(n,2,2)+r.get(t,2,3)*r.get(n,3,2)),r.set(e,2,3,r.get(t,2,0)*r.get(n,0,3)+r.get(t,2,1)*r.get(n,1,3)+r.get(t,2,2)*r.get(n,2,3)+r.get(t,2,3)*r.get(n,3,3)),r.set(e,3,0,r.get(t,3,0)*r.get(n,0,0)+r.get(t,3,1)*r.get(n,1,0)+r.get(t,3,2)*r.get(n,2,0)+r.get(t,3,3)*r.get(n,3,0)),r.set(e,3,1,r.get(t,3,0)*r.get(n,0,1)+r.get(t,3,1)*r.get(n,1,1)+r.get(t,3,2)*r.get(n,2,1)+r.get(t,3,3)*r.get(n,3,1)),r.set(e,3,2,r.get(t,3,0)*r.get(n,0,2)+r.get(t,3,1)*r.get(n,1,2)+r.get(t,3,2)*r.get(n,2,2)+r.get(t,3,3)*r.get(n,3,2)),r.set(e,3,3,r.get(t,3,0)*r.get(n,0,3)+r.get(t,3,1)*r.get(n,1,3)+r.get(t,3,2)*r.get(n,2,3)+r.get(t,3,3)*r.get(n,3,3)),e}static transform3(e,t){let n=t[0],i=t[1],s=t[2];return t[0]=r.get(e,0,0)*n+r.get(e,0,1)*i+r.get(e,0,2)*s+r.get(e,0,3),t[1]=r.get(e,1,0)*n+r.get(e,1,1)*i+r.get(e,1,2)*s+r.get(e,1,3),t[2]=r.get(e,2,0)*n+r.get(e,2,1)*i+r.get(e,2,2)*s+r.get(e,2,3),t}transform3(e){let t=e[0],n=e[1],i=e[2];return e[0]=r.get(this,0,0)*t+r.get(this,0,1)*n+r.get(this,0,2)*i+r.get(this,0,3),e[1]=r.get(this,1,0)*t+r.get(this,1,1)*n+r.get(this,1,2)*i+r.get(this,1,3),e[2]=r.get(this,2,0)*t+r.get(this,2,1)*n+r.get(this,2,2)*i+r.get(this,2,3),e}static mul3(e,t){let n=t[0],i=t[1],s=t[2];return t[0]=r.get(e,0,0)*n+r.get(e,0,1)*i+r.get(e,0,2)*s,t[1]=r.get(e,1,0)*n+r.get(e,1,1)*i+r.get(e,1,2)*s,t[2]=r.get(e,2,0)*n+r.get(e,2,1)*i+r.get(e,2,2)*s,t}static mul4(e,t){let n=t[0],i=t[1],s=t[2],o=t[3];return t[0]=r.get(e,0,0)*n+r.get(e,0,1)*i+r.get(e,0,2)*s+r.get(e,0,3)*o,t[1]=r.get(e,1,0)*n+r.get(e,1,1)*i+r.get(e,1,2)*s+r.get(e,1,3)*o,t[2]=r.get(e,2,0)*n+r.get(e,2,1)*i+r.get(e,2,2)*s+r.get(e,2,3)*o,t[3]=r.get(e,3,0)*n+r.get(e,3,1)*i+r.get(e,3,2)*s+r.get(e,3,3)*o,t}static inverse(e,t,n=.001){let i=e[0]*e[5]-e[1]*e[4],s=e[0]*e[6]-e[2]*e[4],o=e[0]*e[7]-e[3]*e[4],a=e[1]*e[6]-e[2]*e[5],b=e[1]*e[7]-e[3]*e[5],p=e[2]*e[7]-e[3]*e[6],f=e[8]*e[13]-e[9]*e[12],x=e[8]*e[14]-e[10]*e[12],c=e[8]*e[15]-e[11]*e[12],h=e[9]*e[14]-e[10]*e[13],L=e[9]*e[15]-e[11]*e[13],d=e[10]*e[15]-e[11]*e[14],R=i*d-s*L+o*h+a*c-b*x+p*f,g=t??r.create();if(Math.abs(R)<=n)return console.warn("Determinant < epsilon"),g;g[0]=+e[5]*d-e[6]*L+e[7]*h,g[4]=-e[4]*d+e[6]*c-e[7]*x,g[8]=+e[4]*L-e[5]*c+e[7]*f,g[12]=-e[4]*h+e[5]*x-e[6]*f,g[1]=-e[1]*d+e[2]*L-e[3]*h,g[5]=+e[0]*d-e[2]*c+e[3]*x,g[9]=-e[0]*L+e[1]*c-e[3]*f,g[13]=+e[0]*h-e[1]*x+e[2]*f,g[2]=+e[13]*p-e[14]*b+e[15]*a,g[6]=-e[12]*p+e[14]*o-e[15]*s,g[10]=+e[12]*b-e[13]*o+e[15]*i,g[14]=-e[12]*a+e[13]*s-e[14]*i,g[3]=-e[9]*p+e[10]*b-e[11]*a,g[7]=+e[8]*p-e[10]*o+e[11]*s,g[11]=-e[8]*b+e[9]*o-e[11]*i,g[15]=+e[8]*a-e[9]*s+e[10]*i;let V=1/R;return g[0]*=V,g[1]*=V,g[2]*=V,g[3]*=V,g[4]*=V,g[5]*=V,g[6]*=V,g[7]*=V,g[8]*=V,g[9]*=V,g[10]*=V,g[11]*=V,g[12]*=V,g[13]*=V,g[14]*=V,g[15]*=V,g}static transpose(e){let t=r.idx,n=e[t(0,1)];return e[t(0,1)]=e[t(1,0)],e[t(1,0)]=n,n=e[t(0,2)],e[t(0,2)]=e[t(2,0)],e[t(2,0)]=n,n=e[t(0,3)],e[t(0,3)]=e[t(3,0)],e[t(3,0)]=n,n=e[t(1,2)],e[t(1,2)]=e[t(2,1)],e[t(2,1)]=n,n=e[t(1,3)],e[t(1,3)]=e[t(3,1)],e[t(3,1)]=n,n=e[t(2,3)],e[t(2,3)]=e[t(3,2)],e[t(3,2)]=n,e}static lookAt(e,t,n=[0,1,0]){let i,s,o,a,b,p,f,x,c,h,L=e[0],d=e[1],R=e[2],g=n[0],V=n[1],T=n[2],m=t[0],E=t[1],U=t[2],W=1e-6;if(Math.abs(L-m)<W&&Math.abs(d-E)<W&&Math.abs(R-U)<W)return r.makeIdentity();let S=r.create();return f=L-m,x=d-E,c=R-U,h=1/Math.hypot(f,x,c),f*=h,x*=h,c*=h,i=V*c-T*x,s=T*f-g*c,o=g*x-V*f,h=Math.hypot(i,s,o),P(h,0)?(i=0,s=0,o=0):(h=1/h,i*=h,s*=h,o*=h),a=x*o-c*s,b=c*i-f*o,p=f*s-x*i,h=Math.hypot(a,b,p),P(h,0)?(a=0,b=0,p=0):(h=1/h,a*=h,b*=h,p*=h),S[0]=i,S[1]=a,S[2]=f,S[3]=0,S[4]=s,S[5]=b,S[6]=x,S[7]=0,S[8]=o,S[9]=p,S[10]=c,S[11]=0,S[12]=-(i*L+s*d+o*R),S[13]=-(a*L+b*d+p*R),S[14]=-(f*L+x*d+c*R),S[15]=1,S}static makePlaneProjection(e,t,n){let i=r.create(),s=-y.dot(e,t),o=y.dot(e,n);return i[0]=o+s-n[0]*e[0],i[1]=-n[1]*e[0],i[2]=-n[2]*e[0],i[3]=-e[0],i[4]=-n[0]*e[1],i[5]=o+s-n[1]*e[1],i[6]=-n[2]*e[1],i[7]=-e[1],i[8]=-n[0]*e[2],i[9]=-n[1]*e[2],i[10]=o+s-n[2]*e[2],i[11]=-e[2],i[12]=-n[0]*s,i[13]=-n[1]*s,i[14]=-n[2]*s,i[15]=o,i}};var H=class r extends Float32Array{static size=4;constructor(){super(r.size)}static create(e){let t=new Float32Array(r.size);return e!=null&&t.set(e),t}static idx(e,t){return 2*t+e}static set(e,t,n,i){e[r.idx(t,n)]=i}static get(e,t,n){return e[r.idx(t,n)]}static transform2(e,t,n){return w.set(t,r.get(e,0,0)*n[0]+r.get(e,0,1)*n[1],r.get(e,1,0)*n[0]+r.get(e,1,1)*n[1]),t}static makeIdentity(){let e=r.create();return e[r.idx(0,0)]=1,e[r.idx(1,1)]=1,e}static makeRotation(e){let[t,n]=[Math.cos(e),Math.sin(e)],i=r.create();return r.set(i,0,0,t),r.set(i,0,1,-n),r.set(i,1,0,n),r.set(i,1,1,t),i}static rotate(e,t){let[n,i]=[Math.cos(t),Math.sin(t)];return r.set(e,0,0,n),r.set(e,0,1,-i),r.set(e,1,0,i),r.set(e,1,1,n),e}static makeScale(e){let t=r.create();return r.set(t,0,0,e[0]),r.set(t,1,1,e[1]),t}static mul(e,t,n){return r.set(e,0,0,r.get(t,0,0)*r.get(n,0,0)+r.get(t,0,1)*r.get(n,1,0)),r.set(e,0,1,r.get(t,0,0)*r.get(n,0,1)+r.get(t,0,1)*r.get(n,1,1)),r.set(e,1,0,r.get(t,1,0)*r.get(n,0,0)+r.get(t,1,1)*r.get(n,1,0)),r.set(e,1,1,r.get(t,1,0)*r.get(n,0,1)+r.get(t,1,1)*r.get(n,1,1)),e}static inverse(e,t=1e-4){let n=r.create(),i=e[0]*e[3]-e[1]*e[2];if(Math.abs(i)>t){let s=1/i;n[0]=e[3]*s,n[1]=-e[1]*s,n[2]=-e[2]*s,n[3]=e[0]*s}else n.fill(0);return n}};var A=(u=>(u[u.NONE=0]="NONE",u[u.BOOL=WebGL2RenderingContext.BOOL]="BOOL",u[u.UBYTE=WebGL2RenderingContext.UNSIGNED_BYTE]="UBYTE",u[u.BYTE=WebGL2RenderingContext.BYTE]="BYTE",u[u.USHORT=WebGL2RenderingContext.UNSIGNED_SHORT]="USHORT",u[u.SHORT=WebGL2RenderingContext.SHORT]="SHORT",u[u.UINT=WebGL2RenderingContext.UNSIGNED_INT]="UINT",u[u.INT=WebGL2RenderingContext.INT]="INT",u[u.HALF_FLOAT=WebGL2RenderingContext.HALF_FLOAT]="HALF_FLOAT",u[u.FLOAT=WebGL2RenderingContext.FLOAT]="FLOAT",u[u.VEC2=WebGL2RenderingContext.FLOAT_VEC2]="VEC2",u[u.VEC3=WebGL2RenderingContext.FLOAT_VEC3]="VEC3",u[u.VEC4=WebGL2RenderingContext.FLOAT_VEC4]="VEC4",u[u.IVEC2=WebGL2RenderingContext.INT_VEC2]="IVEC2",u[u.IVEC3=WebGL2RenderingContext.INT_VEC3]="IVEC3",u[u.IVEC4=WebGL2RenderingContext.INT_VEC4]="IVEC4",u[u.MAT2=WebGL2RenderingContext.FLOAT_MAT2]="MAT2",u[u.MAT3=WebGL2RenderingContext.FLOAT_MAT3]="MAT3",u[u.MAT4=WebGL2RenderingContext.FLOAT_MAT4]="MAT4",u[u.SAMPLER_2D=WebGL2RenderingContext.SAMPLER_2D]="SAMPLER_2D",u[u.SAMPLER_3D=WebGL2RenderingContext.SAMPLER_3D]="SAMPLER_3D",u[u.SAMPLER_CUBE=WebGL2RenderingContext.SAMPLER_CUBE]="SAMPLER_CUBE",u[u.ISAMPLER_2D=WebGL2RenderingContext.INT_SAMPLER_2D]="ISAMPLER_2D",u[u.ISAMPLER_3D=WebGL2RenderingContext.INT_SAMPLER_3D]="ISAMPLER_3D",u[u.ISAMPLER_CUBE=WebGL2RenderingContext.INT_SAMPLER_CUBE]="ISAMPLER_CUBE",u[u.UISAMPLER_2D=WebGL2RenderingContext.UNSIGNED_INT_SAMPLER_2D]="UISAMPLER_2D",u[u.UISAMPLER_3D=WebGL2RenderingContext.UNSIGNED_INT_SAMPLER_3D]="UISAMPLER_3D",u[u.UISAMPLER_CUBE=WebGL2RenderingContext.UNSIGNED_INT_SAMPLER_CUBE]="UISAMPLER_CUBE",u))(A||{});function ze(r,e){let{dataType:t,location:n,value:i,count:s}=e;if(n===-1)return!1;switch(t){case A.BOOL:case A.BYTE:case A.INT:case A.SHORT:case A.SAMPLER_2D:case A.SAMPLER_3D:case A.SAMPLER_CUBE:case A.ISAMPLER_2D:case A.ISAMPLER_3D:case A.ISAMPLER_CUBE:case A.UISAMPLER_2D:case A.UISAMPLER_3D:case A.UISAMPLER_CUBE:s===void 0||s<2?r.uniform1i(n,i):r.uniform1iv(n,new Int32Array(i));break;case A.FLOAT:case A.HALF_FLOAT:ArrayBuffer.isView(i)?r.uniform1fv(n,i):r.uniform1f(n,i);break;case A.UBYTE:case A.UINT:case A.USHORT:r.uniform1ui(n,i);break;case A.VEC2:r.uniform2fv(n,i);break;case A.VEC3:r.uniform3fv(n,i);break;case A.VEC4:r.uniform4fv(n,i);break;case A.IVEC2:r.uniform2iv(n,i);break;case A.IVEC3:r.uniform3iv(n,i);break;case A.IVEC4:r.uniform4iv(n,i);break;case A.MAT2:r.uniformMatrix2fv(n,!1,i);break;case A.MAT3:r.uniformMatrix3fv(n,!1,i);break;case A.MAT4:r.uniformMatrix4fv(n,!1,i);break;case 0:default:return console.warn("Unrecognised uniform data type"),!1}return!0}function k(r,e){let t=Object.keys(e);for(let n=0;n!==t.length;++n)ze(r,e[t[n]])||console.warn("Failed to bind uniform:",t[n])}function _e(r){return r?.name.startsWith("gl_")??r?.name.startsWith("webgl_")??!1}function Ue(r){switch(r){case WebGL2RenderingContext.FLOAT:return 0;case WebGL2RenderingContext.FLOAT_VEC2:return w.create();case WebGL2RenderingContext.FLOAT_VEC3:return y.create();case WebGL2RenderingContext.FLOAT_VEC4:return N.create();case WebGL2RenderingContext.FLOAT_MAT2:return H.create();case WebGL2RenderingContext.FLOAT_MAT3:return v.create();case WebGL2RenderingContext.FLOAT_MAT4:return l.create();case WebGL2RenderingContext.INT:return 0;case WebGL2RenderingContext.SAMPLER_2D:return 0;case WebGL2RenderingContext.SAMPLER_3D:return 0;case WebGL2RenderingContext.SAMPLER_CUBE:return 0;default:return null}}function Z(r,e){let t={},n=r.getProgramParameter(e,r.ACTIVE_UNIFORMS);for(let i=0;i!==n;++i){let s=r.getActiveUniform(e,i);if(_e(s)){console.log("builtin:",s);continue}if(s==null)continue;let o=r.getUniformLocation(e,s.name);if(o==null)continue;let{name:a,type:b,size:p}=s;t[a]={value:Ue(b),location:o,dataType:b,count:p}}return t}var ie={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},fe={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},pe=new globalThis.TextEncoder;function We(r,e){let t=ie[e],n=fe[e];for(let i=0;i<r.length;i++)n^=BigInt(r[i]),n=BigInt.asUintN(e,n*t);return n}function qe(r,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");let n=ie[e],i=fe[e],s=r;for(;s.length>0;){let o=pe.encodeInto(s,t);s=s.slice(o.read);for(let a=0;a<o.written;a++)i^=BigInt(t[a]),i=BigInt.asUintN(e,i*n)}return i}function se(r,{size:e,utf8Buffer:t}={size:32}){if(!ie[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof r=="string"){if(t)return qe(r,e,t);r=pe.encode(r)}return We(r,e)}var C=class{name_;source_;hash_;resource_;base;rebuild_=!0;static register(e){throw TypeError("Tried to build base Material type")}constructor(e){this.name_=e??"",this.base={attribs:[]}}set rebuild(e){this.rebuild_=e}get rebuild(){return this.rebuild_}get attribs(){return this.base.attribs}set attribs(e){this.base.attribs=e?.map(t=>({...t}))}get name(){return this.name_}set name(e){this.name_=e}set resource(e){this.resource_=e}get resource(){return this.resource_}set props(e){for(let t in e)t in this&&typeof this[t]!="function"&&(this[t]=e[t])}get props(){return{}}set source(e){this.source_=e}get source(){return this.source_}get hash(){if(this.hash_)return this.hash_;let e=new Array,t=this.props;for(let n in t)switch(typeof t[n]){case"object":{let i=t[n].constructor.name;e.push(i);break}case"boolean":case"number":t[n]&&e.push(n);break;case"string":e.push(t[n]);break;default:console.error("Unhandled:",n,t[n])}for(let[n,i]of this.defines)e.push(`${n}=${i}`);return this.hash_=se(e.join(""),{size:32}),this.hash_}get defines(){let e=new Map;for(let t of this.base.attribs??[])e.set(t.type,J.indexOf(t.type).toString());return e}};var de=document.createElement("canvas").getContext("2d");function oe(r,e){let t,n,i;if(typeof r=="string")if(r.startsWith("#")){let s=r.slice(1);t=parseInt(s.slice(0,2),16),n=parseInt(s.slice(2,4),16),i=parseInt(s.slice(4,6),16)}else if(r.startsWith("rgb")){let s=r.match(/\d+/g);if(s&&s.length===3)[t,n,i]=s.map(Number);else throw new Error("Invalid RGB string format")}else return de.fillStyle=r,oe(de.fillStyle,e);else if(Array.isArray(r)&&r.length===3)if(r.every(s=>s>=0&&s<=1))[t,n,i]=r.map(s=>Math.round(s*255));else if(r.every(s=>s>=0&&s<=255))[t,n,i]=r.map(Math.round);else throw new Error("Invalid array input values");else throw new Error("Invalid input type");switch(e){case"HEX":return`#${t.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}`;case"RGB_STRING":return`rgb(${t}, ${n}, ${i})`;case"RGB_ARRAY":return[t,n,i];case"RGB_NORMALISED":return[t/255,n/255,i/255];case"SRGB_NORMALISED":return[Math.pow(t/255,2.2),Math.pow(n/255,2.2),Math.pow(i/255,2.2)];default:throw new Error("Invalid output format")}}var He=`
layout(location = POSITION) in vec3 position;

#if defined(TEXCOORD0)
layout(location = TEXCOORD0) in vec2 texcoord0;
out vec2 uv0;
#endif // TEXCOORD0

#if defined(COLOUR0)
layout(location = COLOUR0) in vec3 colour0;
out vec3 col0;
#endif // COLOUR0

uniform mat4 modelViewProjMatrix;

void main() {
  gl_Position = modelViewProjMatrix * vec4(position, 1.0);
#if defined(TEXCOORD0)
  uv0 = texcoord0;
#endif // TEXCOORD0
#if defined(COLOUR0)
  col0 = colour0;
#endif // COLOUR0
}
`,je=`
#include <gammaCorrect>
  
#if defined(HAS_MAP)
uniform sampler2D map;
#endif // HAS_MAP

#if defined(TEXCOORD0)
in vec2 uv0;
#endif // TEXCOORD0

#if defined(COLOUR0)
in vec3 col0;
#endif // COLOUR0

uniform vec3 diffuseColour;

out vec4 fragColour;

void main() {
#if defined(HAS_MAP) && defined(TEXCOORD0)
  fragColour = texture(map, uv0);
#else
  fragColour = vec4(1.);
#endif
  
#if defined(COLOUR0)
  fragColour.rgb *= diffuseColour * col0.rgb;
#else
  fragColour.rgb *= diffuseColour;
#endif
  
  fragColour.rgb = gammaCorrect(fragColour.rgb);
}
`,me="BasicMaterial",B=class extends C{data;dirty={};static register(e){e.hasTemplate(me)||e.addTemplate(me,[He,je])}constructor(e){super(e),this.data={colour:new y(1)}}set colour(e){this.data.colour.set(oe(e,"SRGB_NORMALISED"))}get colour(){return this.data.colour}set map(e){this.data.map=e}get map(){return this.data.map}set props(e){super.props=e}get props(){return this.data}get defines(){let e=new Map,t=super.defines;for(let[n,i]of t)e.set(n,i);return this.data.map&&e.set("HAS_MAP",""),e}};var ge=`const vec2 pos[3]=vec2[3](vec2(-1.0,-1.0),vec2(+3.0,-1.0),vec2(-1.0,+3.0));
#if defined(HAS_UV0)
out vec2 uv0;
#endif
void main(){
#if defined(HAS_UV0)
uv0=pos[gl_VertexID]*0.5+0.5;
#if defined(FLIP_Y)
uv0=vec2(uv0.x,1.-uv0.y);
#endif
#endif
gl_Position=vec4(pos[gl_VertexID],0.0,1.0);}`;var ye=`#include <gammaCorrect>
#if defined(HAS_UV0)
in vec2 uv0;
#endif
#if defined(HAS_MAP)
uniform sampler2D map;
#endif
uniform float opacity;out vec4 fragColour;void main(){
#if defined(HAS_MAP) && defined(HAS_UV0)
fragColour=texture(map,uv0);
#elif defined(HAS_UV0)
fragColour=vec4(uv0,1.0-uv0.x,1.0);
#else
fragColour=vec4(1.0);
#endif
#if defined(GAMMA_CORRECT)
fragColour.rgb=gammaCorrect(fragColour.rgb);
#endif
fragColour.a=opacity;}`;var xe="ScreenQuadMaterial",G=class extends C{data;dirty={};static register(e){e.hasTemplate(xe)||e.addTemplate(xe,[ge,ye])}constructor(e){super(e),this.data={opacity:1}}set map(e){this.data.map=e}get map(){return this.data.map}set flipY(e){this.data.flipY=e}get flipY(){return this.data.flipY}set gammaCorrect(e){this.data.gammaCorrect=e}get gammaCorrect(){return this.data.gammaCorrect}set opacity(e){this.data.opacity=e}get opacity(){return this.data.opacity}set props(e){super.props=e}get props(){return this.data}get defines(){let e=new Map,t=super.defines;for(let[n,i]of t)e.set(n,i);return this.data.map&&e.set("HAS_MAP",""),this.data.flipY&&e.set("FLIP_Y","1"),this.data.gammaCorrect&&e.set("GAMMA_CORRECT",""),e.set("HAS_UV0",""),e}};var ve=`layout(location=POSITION)in vec3 position;
#if defined(NORMAL)
layout(location=NORMAL)in vec3 normal;
#endif
uniform PerFrameData{mat4 projectionViewMatrix;mat4 projectionMatrix;mat4 worldToViewMatrix;mat4 viewToWorldMatrix;};uniform PerObjectData{mat4 mvpMatrix;mat4 modelMatrix;mat4 modelViewMatrix;mat4 normalMatrix;};struct V2F{vec3 vPos;
#if defined(NORMAL)
vec3 vNor;
#endif
};out V2F v2f;void main(){v2f.vPos=(modelViewMatrix*vec4(position,1.0)).xyz;v2f.vNor=normalize((normalMatrix*vec4(normal,0.0)).xyz);gl_Position=mvpMatrix*vec4(position,1.0);}`;var Ae=`uniform PerFrameData{mat4 projectionViewMatrix;mat4 projectionMatrix;mat4 worldToViewMatrix;mat4 viewToWorldMatrix;};struct V2F{vec3 vPos;
#if defined(NORMAL)
vec3 vNor;
#endif
};in V2F v2f;out vec3 fragOutput[2];uniform vec2 outputScaleBias;void main(){fragOutput[0]=normalize(v2f.vNor*outputScaleBias.x+outputScaleBias.y);fragOutput[1]=v2f.vPos;}`;var Le="GBufferMaterial",z=class extends C{data;dirty={};static register(e){e.hasTemplate(Le)||e.addTemplate(Le,[ve,Ae])}constructor(e){super(e),this.data={normal:!0,view:!1}}set normal(e){this.data.normal=e}get normal(){return this.data.normal}set view(e){this.data.view=e}get view(){return this.data.view}set props(e){super.props=e}get props(){return this.data}get defines(){let e=new Map,t=super.defines;for(let[n,i]of t)e.set(n,i);return e}};var Pr={BasicMaterial:{Constructor:B,register:B.register},ScreenQuadMaterial:{Constructor:G,register:G.register},GBufferMaterial:{Constructor:z,register:z.register}};var Zr=WebGL2RenderingContext.COLOR_BUFFER_BIT|WebGL2RenderingContext.DEPTH_BUFFER_BIT|WebGL2RenderingContext.STENCIL_BUFFER_BIT;function Me(r,e,t){e=Math.floor(e),t=Math.floor(t);let n=new Float32Array(2*e*t);for(let s=0;s<t;++s)for(let o=0;o<e;++o){let a=2*(s*e+o);n[a]=o/e,n[a+1]=s/t}let i=r.createVertexArray();if(i!=null){r.bindVertexArray(i);let s=r.createBuffer();return s==null?null:(r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,n,r.STATIC_DRAW),r.enableVertexAttribArray(0),r.vertexAttribPointer(0,2,r.FLOAT,!1,0,0),r.bindVertexArray(null),[i,s,n.length/2])}return null}function Ve(r,e){let t=new Map;for(let[n,i]of e){let s=new Float32Array(i),o=r.createVertexArray();if(o!=null){r.bindVertexArray(o);let a=r.createBuffer();if(a==null)return null;r.bindBuffer(r.ARRAY_BUFFER,a),r.bufferData(r.ARRAY_BUFFER,s,r.STATIC_DRAW),r.enableVertexAttribArray(0),r.vertexAttribPointer(0,3,r.FLOAT,!1,0,0),r.bindVertexArray(null),t.set(Number(n),[o,a,s.length/3])}}return t}var j=new Map;var Se=`#version 300 es
precision mediump float;
#define PI 3.141592653589793238
#define TWO_PI (PI + PI)
vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x,289.0);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+1.0*C.xxx;vec3 x2=x0-i2+2.0*C.xxx;vec3 x3=x0-1.+3.0*C.xxx;i=mod(i,289.0);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=1.0/7.0;vec3  ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}layout(location=0)in vec3 position;uniform mat4 mvp;uniform mat4 mv;uniform float pointSize;uniform float time;uniform vec4 speeds;uniform vec4 layerControls;uniform vec4 landmass;uniform float randomSeed;uniform int visibility;uniform int scalePoints;uniform vec4 frequencies;uniform float opacity;
#define emissionSpeed speeds.x
#define evolutionSpeed speeds.y
#define rotationSpeed speeds.z
#define layerScaleDelta layerControls.y
#define emissionStart landmass.x
#define emissionEnd landmass.y
#define emissionHeight landmass.z
#define sealevel landmass.w
#define emissionFreq frequencies.x
#define landFreq frequencies.y
#define rotFreq frequencies.z
#define rotMag frequencies.w
out vec4 pos;vec2 rot(vec2 v,float a){return mat2(cos(a),-sin(a),sin(a),cos(a))*v;}float fBM(vec3 p){float f=0.0;f+=0.5000*snoise(p);p.xy=rot(p.xy,0.5);f+=0.2500*snoise(2.*p);p.xy=rot(p.xy,0.5);f+=0.1250*snoise(4.*p);p.xy=rot(p.xy,0.5);f+=0.0625*snoise(8.*p);return f/0.9375;}vec2 cart2sphere(vec3 coord){return vec2(atan(coord.z,coord.x),acos(coord.y));}mat3 buildFrame(vec3 N){vec3 U=mix(vec3(1.0,0.0,0.0),vec3(0.0,1.0,0.0),step(.9,abs(N.x)));vec3 B=cross(N,U);vec3 T=cross(B,N);return mat3(B,T,N);}float visTerm(float emission,float land){switch(visibility){case 0:return min(emission,land);case 1:return max(emission,land);case 2:return emission*land;}return min(emission,land);}void main(){vec3 N=normalize(position);float emission=fBM(emissionFreq*N+time*emissionSpeed+vec3(randomSeed));float land=fBM(landFreq*position+time*evolutionSpeed+vec3(randomSeed));float emissionFactor=smoothstep(emissionStart-0.1,emissionEnd+0.1,emission);land=smoothstep(sealevel-0.1,sealevel+0.1,land);vec3 vN=normalize((mv*vec4(N,0.)).xyz);float angle=dot(vN,vec3(0.,0.,1.))*.5+.5;float rotation=TWO_PI*snoise(rotFreq*N+rotationSpeed*time+vec3(-randomSeed,2.*randomSeed,0.));vec3 offset=0.1*rotMag*buildFrame(N)*vec3(rot(vec2(1.,0.),rotation),0.0);pos=vec4(position+emissionHeight*emissionFactor*emission*N+offset,angle*visTerm(emission,land));gl_Position=mvp*vec4(pos.xyz,1.);gl_PointSize=max(pointSize*layerScaleDelta*(scalePoints==1?angle:1.),opacity);}`;var Re=`#version 300 es
precision mediump float;uniform vec4 layerControls;uniform float roundedPoints;uniform float opacity;uniform vec3 baseColour;in vec4 pos;out vec4 fragColour;
#define layerOpacity layerControls.x
#define layer int(layerControls.z)
#define useLayerColours layerControls.w > 0.
float length2(vec2 v){return dot(v,v);}const vec4 colours[5]=vec4[5](vec4(1.0,0.0,0.0,1.0),vec4(0.0,1.0,0.0,1.0),vec4(0.0,0.0,1.0,1.0),vec4(1.0,1.0,0.0,1.0),vec4(1.0,0.0,1.0,1.0));void main(){if(pos.w<1e-2||opacity==0.)discard;if(roundedPoints>0.){float d=length2(gl_PointCoord-.5);if(d>.25)discard;}fragColour=opacity*pos.w*layerOpacity*(useLayerColours?colours[layer]:vec4(baseColour,opacity));}`;var we=`#version 300 es
precision mediump float;vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec2 mod289(vec2 x){return x-floor(x*(1.0/289.0))*289.0;}vec3 permute(vec3 x){return mod289(((x*34.0)+1.0)*x);}float snoise(vec2 v){const vec4 C=vec4(0.211324865405187,0.366025403784439,-0.577350269189626,0.024390243902439);vec2 i=floor(v+dot(v,C.yy));vec2 x0=v-i+dot(i,C.xx);vec2 i1;i1=(x0.x>x0.y)?vec2(1.0,0.0):vec2(0.0,1.0);vec4 x12=x0.xyxy+C.xxzz;x12.xy-=i1;i=mod289(i);vec3 p=permute(permute(i.y+vec3(0.0,i1.y,1.0))+i.x+vec3(0.0,i1.x,1.0));vec3 m=max(0.5-vec3(dot(x0,x0),dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)),0.0);m=m*m;m=m*m;vec3 x=2.0*fract(p*C.www)-1.0;vec3 h=abs(x)-0.5;vec3 ox=floor(x+0.5);vec3 a0=x-ox;m*=1.79284291400159-0.85373472095314*(a0*a0+h*h);vec3 g;g.x=a0.x*x0.x+h.x*x0.y;g.yz=a0.yz*x12.xz+h.yz*x12.yw;return 130.0*dot(m,g);}
#define PI 3.141592653589793238
#define TWO_PI (PI + PI)
layout(location=0)in vec2 position;const vec3 layerAxes[5]=vec3[](vec3(1.0,1.0,0.0),vec3(1.0,-1.0,-1.0),vec3(-1.0,1.0,0.0),vec3(0.0,1.0,-1.0),vec3(1.0,0.0,1.0));uniform mat4 mvp;uniform float pointSize;uniform float time;uniform vec3 resolution;uniform int layer;out vec2 uv;flat out float colourP;const float screenScale=2.2;vec3 mapToCylinder(vec2 uv,float radius,float t){const float width=6.0;float theta=uv.x*TWO_PI+t-PI/2.0;float s=abs(.5-uv.y)*.5;s=s*s+0.1*s+.1*snoise(uv*13.0);return vec3(-s*width*cos(theta),.75*(2.*uv.y-1.),s*width*sin(theta));}vec3 displacement(vec2 uv){return vec3(snoise(vec2(1.283,1.437)*uv),snoise(vec2(-1.823,0.934)*uv),snoise(vec2(-0.32,-1.38)*uv));}vec3 rotate(vec3 v,float theta){return mat3(cos(theta),0.,-sin(theta),0.,1.,0.,sin(theta),0.,cos(theta))*v;}float rand(vec2 co){return fract(sin(dot(co.xy,vec2(12.9898,78.233)))*43758.5453);}vec3 uvToSpherical(vec2 uv,float time){float p=smoothstep(0.0,0.5,time)-smoothstep(0.5,1.5,time);float phi=uv.x*TWO_PI+PI/2.+p*0.2*(rand(uv)*2.-1.);float theta=(1.-uv.y)*PI+p*0.2*(rand(uv)*2.-1.);return vec3(sin(theta)*cos(phi),cos(theta),sin(theta)*sin(phi));}void main(){uv=fract(position.xy+vec2(0e-3*time,0.0));vec2 pos=position.xy;colourP=snoise(200.*uv)*.5+.5;gl_PointSize=.25*pointSize+.75*pointSize*(snoise(100.*uv)*.5+.5);vec2 scale=vec2(resolution[2],1.)*screenScale;float ani=max(0.225*time,0.0);vec3 P=vec3(fract(pos)*scale,0.0);P.xy-=vec2(resolution[2]*.5,.5)*2.2;vec3 Q=mapToCylinder(pos,.5,0.)+.01*displacement(uv+2.*time+float(layer));vec3 S=uvToSpherical(pos,ani)+.01*displacement(uv+2.*time+float(layer));vec3 R=mix(mix(P,Q,0.),S,ani);R=rotate(R,4.0*ani*ani*(ani*PI/3.*float(layer+1)));gl_Position=mvp*vec4(R,1.0);gl_PointSize=mix(gl_PointSize,.5*gl_PointSize,smoothstep(0.0,1.0,ani));}`;var Ce=`#version 300 es
precision mediump float;float length2(vec2 v){return dot(v,v);}uniform float roundedPoints;uniform float time;uniform float opacity;in vec2 uv;flat in float colourP;out vec4 fragColour;const vec3 colour=vec3(34./255.99,46./255.99,55./255.99);void main(){float d=length2(gl_PointCoord-.5);if(d>.25)discard;vec3 pColour=mix(colour,mix(colour,vec3(1.),.4),1.15*colourP-0.15);float edge=1.-smoothstep(0.25*.6,.25*.9,d);fragColour=mix(vec4(colour,1.),vec4(mix(colour,pColour,edge),1.),opacity);}`;async function ae(r){let e=await fetch(r);if(!e.ok)throw new Error(`Failed to load buffer from: ${r}`);return await e.arrayBuffer()}var tt="https://cdn.jsdelivr.net/gh/otgaard/cdn@0.0.34/data/vbuf001.bin",rt="https://cdn.jsdelivr.net/gh/otgaard/cdn@0.0.34/data/vbuf003.bin",nt="https://cdn.jsdelivr.net/gh/otgaard/cdn@0.0.34/data/vbuf005.bin",it=["min","max","mul"],_={none:"{}",about:'{"customScale":1.1,"rotationSpeed":0,"dirChangeFreq":0.01,"dirChangeStrength":0,"dirChangeVariance":0,"layers":1,"sampleRadius":0.01,"layerStepDistance":0.01,"layerOpacityDelta":0,"pointSize":0.54,"opacity":1,"emissionFreq":17.5,"emissionSpeed":1.5,"emissionStart":-1,"emissionEnd":1,"emissionHeight":-1,"evolutionSpeed":0,"landFreq":0.1,"sealevel":1,"sealevelLayerDelta":0.5,"rotationFreq":0,"rotationMag":0,"angularRotSpeed":0,"visibility":"max","randomSeed":true,"layerColours":false,"roundedPoints":true,"lockAxes":true,"scalePoints":true,"showText":false,"line1":"Defining the future of","line2":"business solutions.","preset":"none","resolution":[2880,1580,1.8227848101265822]}',ai:'{"customScale":1.0,"rotationSpeed":1,"dirChangeFreq":0.01,"dirChangeStrength":0.55,"dirChangeVariance":1,"layers":5,"sampleRadius":0.03,"layerStepDistance":0.07,"layerOpacityDelta":0.12,"pointSize":1.15,"opacity":0.25,"emissionFreq":2.9,"emissionSpeed":2.3,"emissionStart":1,"emissionEnd":0.61,"emissionHeight":-1,"evolutionSpeed":0.5,"landFreq":7.8,"sealevel":0.28,"sealevelLayerDelta":-0.5,"rotationFreq":0,"rotationMag":0,"angularRotSpeed":0,"visibility":"max","randomSeed":true,"layerColours":false,"roundedPoints":true,"lockAxes":true,"scalePoints":true,"resolution":[2880,1580,1.8227848101265822]}',b2b:'{"customScale":1.1,"rotationSpeed":1,"dirChangeFreq":0.01,"dirChangeStrength":1,"dirChangeVariance":0,"layers":5,"sampleRadius":0.05,"layerStepDistance":0.44,"layerOpacityDelta":0,"pointSize":0.9,"opacity":0.35,"emissionFreq":13.2,"emissionSpeed":20,"emissionStart":-1,"emissionEnd":-0.23,"emissionHeight":-0.06,"evolutionSpeed":0,"landFreq":6.3,"sealevel":0.19,"sealevelLayerDelta":-0.5,"rotationFreq":40,"rotationMag":1,"angularRotSpeed":0,"visibility":"max","randomSeed":true,"layerColours":false,"roundedPoints":true,"lockAxes":true,"scalePoints":true,"resolution":[2880,1580,1.8227848101265822]}',clean:'{"customScale":1.08,"rotationSpeed":1,"dirChangeFreq":1,"dirChangeStrength":0.55,"dirChangeVariance":1,"layers":1,"sampleRadius":0.03,"layerStepDistance":0.07,"layerOpacityDelta":0.12,"pointSize":0.72,"opacity":0.3,"emissionFreq":13.2,"emissionSpeed":10.2,"emissionStart":1,"emissionEnd":-1,"emissionHeight":0.34,"evolutionSpeed":0.5,"landFreq":2.6,"sealevel":0.21,"sealevelLayerDelta":-0.5,"rotationFreq":0,"rotationMag":0,"angularRotSpeed":0,"visibility":"max","randomSeed":true,"layerColours":false,"roundedPoints":true,"lockAxes":true,"scalePoints":true,"resolution":[2880,1580,1.8227848101265822]}',base:'{"customScale":1.0,"rotationSpeed":0.8,"dirChangeFreq":0.01,"dirChangeStrength":0.01,"dirChangeVariance":0,"layers":3,"sampleRadius":0.01,"layerStepDistance":0.2,"layerOpacityDelta":0.5,"pointSize":0.5,"opacity":1,"emissionFreq":2,"emissionSpeed":4.3,"emissionStart":1,"emissionEnd":-0.7,"emissionHeight":1,"evolutionSpeed":8,"landFreq":14.1,"sealevel":0.08,"sealevelLayerDelta":-0.3,"rotationFreq":28,"rotationMag":0.69,"angularRotSpeed":0,"visibility":"mul","randomSeed":true,"layerColours":false,"roundedPoints":true,"lockAxes":false,"scalePoints":true,"showText":true,"line1":"Defining the future of","line2":"business solutions.","preset":"none","resolution":[2880,1580,1.8227848101265822]}'},st={rotationSpeed:.8,dirChangeFreq:.01,dirChangeStrength:.01,dirChangeVariance:0,layers:3,sampleRadius:.01,layerStepDistance:.2,layerOpacityDelta:.5,pointSize:.5,opacity:1,emissionFreq:2,emissionSpeed:4.3,emissionStart:1,emissionEnd:-.7,emissionHeight:1,evolutionSpeed:8,landFreq:14.1,sealevel:.08,sealevelLayerDelta:-.3,rotationFreq:28,rotationMag:.69,angularRotSpeed:0,visibility:"mul",randomSeed:!0,layerColours:!1,roundedPoints:!0,lockAxes:!1,scalePoints:!0,showText:!0,line1:"Defining the future of",line2:"business solutions.",preset:"none",resolution:[2157,1079,2157/1079]};function ee(r,e){for(let t in e)typeof e[t]=="object"?ee(r[t],e[t]):r[t]=e[t]}var Y=4,ot=.02,at=.1,O=[y.normalise([1,1,0]),y.normalise([1,-1,-1]),y.normalise([-1,1,0]),y.normalise([0,1,-1]),y.normalise([1,0,1])],ct=[.27478805808024576,.7651830778546598,.09990401387135628,.5521414685809944,.8017688214506036],Q=class{controls=JSON.parse(JSON.stringify(st));controlTarget=null;targetName_="";controlSource=null;sourceName="base";controlTime=0;transition_=0;angle=0;currArrays={source:new Array,targets:new Array,rotAccum:new Array,freq:new Array,rotations:new Array,layerDisplayTime:new Array};targetArrays={source:new Array,targets:new Array,rotAccum:new Array,freq:new Array,rotations:new Array,layerDisplayTime:new Array};time=0;introTime=Y;valid;canvasId;canvas;gl;width=0;height=0;planePoints=null;points=null;programs=[];ctx=[];overlay=document.getElementById("overlay");line1=document.getElementById("line1");line2=document.getElementById("line2");rnd={gen:X(18284.480873),random:(e,t)=>D(e,t,this.rnd.gen.double())};get transition(){return this.transition_}set transition(e){this.transition_=e}get colour(){return this.ctx[0].baseColour.value}set colour(e){this.ctx[0].baseColour.value=e}get currName(){return this.sourceName}get targetName(){return this.targetName_}load(e){ee(this.controls,JSON.parse(_[e])),this.rebuild();let n=this.gl.canvas.getBoundingClientRect(),i=Math.round(n.width),s=Math.round(n.height),o=window.devicePixelRatio,a=Math.round(o*i),b=Math.round(o*s);this.width=a,this.height=b,this.gl.viewport(0,0,this.width,this.height);let p=l.mul(l.makeIdentity(),l.lookAt([0,0,5],[0,0,0],[0,1,0]),l.makeRotation([1,0,0],Math.PI/2));this.ctx[0].mvp.value=l.mul(l.makeIdentity(),l.makePerspective(45,this.width/this.height,.5,5),p),this.gl.useProgram(this.programs[0]),k(this.gl,this.ctx[0])}rebuild(e=!1){if(this.planePoints!=null&&(this.gl.deleteVertexArray(this.planePoints[0]),this.gl.deleteBuffer(this.planePoints[1])),this.points=Ve(this.gl,j),this.points==null)return;let t=Math.floor(this.width/32),n=Math.floor(this.height/32);this.planePoints=Me(this.gl,t,n),this.controlSource=JSON.parse(JSON.stringify(this.controls)),this.currArrays.rotAccum=new Array(this.controls.layers).fill(0),this.currArrays.rotations=O.slice(0,this.controls.layers).map(i=>new y(i)),this.currArrays.source=O.slice(0,this.controls.layers).map(i=>new y(i)),this.currArrays.targets=O.slice(0,this.controls.layers).map(i=>new y(i)),this.currArrays.rotAccum=new Array(this.controls.layers).fill(0),this.currArrays.freq=new Array(this.controls.layers).fill(this.controls.dirChangeFreq),this.introTime=e?Y:0,this.line1!=null&&(this.line1.innerText=this.controls.line1),this.line2!=null&&(this.line2.innerText=this.controls.line2),this.overlay!=null&&this.overlay.classList.contains("hidden")===this.controls.showText&&this.overlay.classList.toggle("hidden"),this.time=0,this.angle=0,this.rnd={gen:X(18284.480873),random:(i,s)=>D(i,s,this.rnd.gen.double())}}initiateLerp(e,t){if(!(this.targetName_===t&&this.sourceName===t)){if(this.sourceName===t){this.controlTarget=null,this.controlTime=0;return}this.targetName_=t,this.controlTarget=e,this.controlTime=0,this.targetArrays={source:O.slice(0,e.layers).map(n=>new y(n)),targets:O.slice(0,e.layers).map(n=>new y(n)),rotAccum:new Array(e.layers).fill(0),freq:new Array(e.layers).fill(e.dirChangeFreq),rotations:O.slice(0,e.layers).map(n=>new y(n)),layerDisplayTime:new Array(e.layers).fill(0)}}}buildShaders(){let e=this.gl;this.programs=new Array(2);let t=K(e,Se,Re);typeof t=="string"?console.error("Compile Error:",t):(this.programs[0]=t,e.useProgram(t),this.ctx[0]=Z(e,t),this.ctx[0].mvp.value=l.mul(l.makeIdentity(),l.makePerspective(45,1,.5,5),l.lookAt([0,0,5],[0,0,0],[0,1,0])),this.ctx[0].pointSize.value=this.controls.pointSize,this.ctx[0].baseColour.value=[1,1,1],k(e,this.ctx[0]));let n=K(e,we,Ce);typeof n=="string"?console.error("Compile Error:",n):(this.programs[1]=n,e.useProgram(n),this.ctx[1]=Z(e,n),this.ctx[1].mvp.value=l.mul(l.makeIdentity(),l.makePerspective(45,1,.5,5),l.lookAt([0,0,2],[0,0,0],[0,1,0])),this.ctx[1].pointSize.value=this.controls.pointSize,k(e,this.ctx[1]))}constructor(e,t=!1){if(this.valid=document.getElementById(e)!=null,!this.valid)return;this.canvasId=e;let n=document.getElementById(e);this.canvas=n;let i=n.getContext("webgl2",{alpha:!0,antialias:!1,depth:!0,premultipliedAlpha:!0,stencil:!1});if(i==null)throw new Error("WebGL2 not supported");this.gl=i,i.enable(i.DEPTH_TEST),window.addEventListener("resize",()=>{this.onResize()}),i.clearColor(0,0,0,0),this.buildShaders(),this.onResize()}initialiseData(e){switch(this.canvasId){case"canvas":ee(this.controls,JSON.parse(_.base)),this.rebuild(e);break;case"about-canvas":ee(this.controls,JSON.parse(_.about)),this.rebuild(e);break}}onResize(){if(this.gl.canvas==null||this.ctx==null)return;let e=this.gl.canvas,t=e.getBoundingClientRect(),n=Math.round(t.width),i=Math.round(t.height),s=window.devicePixelRatio,o=Math.round(s*n),a=Math.round(s*i);if(this.width!==o||this.height!==a){this.width=o,this.height=a,e.width=this.width,e.height=this.height,this.gl.viewport(0,0,this.width,this.height);let b=l.mul(l.makeIdentity(),l.lookAt([0,0,5],[0,0,0],[0,1,0]),l.makeRotation([1,0,0],Math.PI/2));this.ctx[0].mvp.value=l.mul(l.makeIdentity(),l.makePerspective(45,this.width/this.height,.5,5),b),this.gl.useProgram(this.programs[0]),k(this.gl,this.ctx[0])}}render(e){if(this.ctx==null)return;let t=this.gl;t.viewport(0,0,this.width,this.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.time+=e;let n=(Y-this.introTime)/Y,i=D(0,1,n>.8?(n-.8)/.2:0),s=1-i;this.introTime>0&&(this.introTime-=e,this.renderIntro(s)),t.useProgram(this.programs[0]);let o=[this.controls,this.controlTarget].filter(x=>x!=null),a=[this.currArrays,this.targetArrays];this.controlTarget&&(this.controlTime+=e);let b=3-.1*q(.7,1,this.transition_),p=this.controlTime,f=[1-p,p];for(let x=0;x<o.length;++x){let c=o[x],h=a[x];this.angle+=x===0?c.rotationSpeed*.1*e:0,this.ctx[0].speeds.value=[c.emissionSpeed*ot,c.evolutionSpeed*at,c.angularRotSpeed,0];let L=this.width/c.resolution[0],d=this.height/c.resolution[1],R=Math.sqrt(L*L+d*d);this.ctx[0].pointSize.value=c.pointSize*R*(1+.8*this.transition_);let g=D(1,.8,this.transition_),V=(m=1)=>new y(this.rnd.random(-1,1),this.rnd.random(-1,1),this.rnd.random(-1,1)).mulScalar(m);for(let m=0;m<c.layers;++m)h.rotAccum[m]-=e,h.rotAccum[m]<=0&&(h.freq[m]=this.rnd.random(c.dirChangeFreq*(1-c.dirChangeVariance),c.dirChangeFreq),h.rotAccum[m]=1/h.freq[m],h.source[m]=new y(h.rotations[m]),h.targets[m]=new y(V(c.dirChangeStrength).add(h.rotations[m])).normalise());for(let m=0;m<c.layers;++m){let E=1-h.rotAccum[m]*h.freq[m];be(h.source[m],h.targets[m],h.rotations[m],q(0,1,E)),h.rotations[m].normalise()}this.ctx[0].time.value=this.time,this.ctx[0].opacity.value=Math.min(c.opacity,i,f[x],g),this.ctx[0].scalePoints.value=c.scalePoints?1:0,this.ctx[0].frequencies.value=[c.emissionFreq,c.landFreq,c.rotationFreq,c.rotationMag];let T=this.width<this.height?this.width/this.height:1;T*=c.customScale??1;for(let m=0;m<c.layers;++m){let E=l.mul(l.makeIdentity(),c.lockAxes?l.makeRotation(O[m],this.angle*(m%2===0?-1:1)):l.makeRotation(h.rotations[m],this.angle*(m%2===0?-1:1)),l.mul(l.makeIdentity(),l.makeRotation([1,0,0],Math.PI/2),l.makeScale([T*(1-m*c.layerStepDistance),T*(1-m*c.layerStepDistance),T*(1-m*c.layerStepDistance)]))),U=l.mul(l.makeIdentity(),l.lookAt([0,0,b],[0,0,0],[0,1,0]),E);this.ctx[0].mv.value=U,this.ctx[0].mvp.value=l.mul(l.makeIdentity(),l.makePerspective(45,this.width/this.height,.5,5),U);let W=I(1-c.layerOpacityDelta*m,0,1),S=5-3*(m/c.layers);if(this.ctx[0].layerControls.value=[W,S,m,c.layerColours?1:0],this.ctx[0].landmass.value=[c.emissionStart,c.emissionEnd,c.emissionHeight,c.sealevel+I(m*c.sealevelLayerDelta,0,1)],this.ctx[0].roundedPoints.value=c.roundedPoints?1:0,this.ctx[0].randomSeed.value=c.randomSeed?ct[m]:0,this.ctx[0].visibility.value=it.indexOf(c.visibility),k(this.gl,this.ctx[0]),this.points?.has(c.sampleRadius)){let re=this.points.get(c.sampleRadius);re&&(t.bindVertexArray(re[0]),t.drawArrays(t.POINTS,0,re[2]))}else console.error("Failed to find points with radius:",c.sampleRadius)}}this.controlTime>1&&(this.controls={...this.controls,...JSON.parse(JSON.stringify(this.controlTarget))},this.controlSource=this.controlTarget,this.currArrays=this.targetArrays,this.sourceName=this.targetName_,this.controlTarget=null,this.controlTime=0)}renderIntro(e){if(this.ctx==null||this.introTime<=0)return;let t=this.gl;t.viewport(0,0,this.width,this.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.useProgram(this.programs[1]);let n=this.width/this.controls.resolution[0],i=this.height/this.controls.resolution[1],s=Math.sqrt(n*n+i*i);this.ctx[1].pointSize.value=6*s,this.ctx[1].time.value=this.time,this.ctx[1].opacity.value=e;let o=1-this.introTime/Y,a=q(0,.5,o)-q(.5,1,o),b=D(3,1.5,a);this.ctx[1].resolution.value=[this.width,this.height,this.width/this.height];for(let p=0;p<5;++p)this.ctx[1].mvp.value=l.mul(l.makeIdentity(),l.makePerspective(45,this.width/this.height,.5,5),l.mul(l.makeIdentity(),l.lookAt([0,0,b],[0,0,0],[0,1,0]),l.makeScale([1-.15*p,1-.15*p,1-.15*p]))),this.ctx[1].layer.value=p,k(t,this.ctx[1]),this.planePoints!=null&&(t.bindVertexArray(this.planePoints[0]),t.drawArrays(t.POINTS,0,this.planePoints[2]))}},ue=new Q("canvas",!0),le=new Q("about-canvas",!1),ut=["ct-accordion","ai-accordion","b2b-accordion"],lt=["clean","ai","b2b"],F=[],$=[],M=[null,null];ue.valid&&(M[0]=ue);le.valid&&(M[1]=le);var ke=performance.now(),ce=performance.now(),Te=1,Oe=()=>{ke=ce,ce=performance.now(),Te=(ce-ke)*.001,M.forEach((r,e)=>{r?.render(Te)}),window.requestAnimationFrame(Oe)};Promise.all([ae(tt),ae(rt),ae(nt)]).then(r=>{j.set(.01,new Float32Array(r[0])),j.set(.03,new Float32Array(r[1])),j.set(.05,new Float32Array(r[2]));for(let e of M)e&&e.initialiseData(e.canvasId==="canvas");window.requestAnimationFrame(Oe)}).catch(r=>{console.error("Failed to load buffers:",r)});function ht(r){let e=r.getBoundingClientRect();return!(e.right<=0||e.left>=window.innerWidth||e.bottom<=0||e.top>=window.innerHeight)}function Fe(){let r=document.getElementById("ai-accordion")?.parentElement?.parentElement??null;if(!r)return console.error("Swiper wrapper not found"),()=>{};let e=r.querySelectorAll(".swiper-slide");if(e.length===0)return console.error("No slides found"),()=>{};let t=[];e.forEach((o,a)=>{let b=o.children[0].getAttribute("id");if(!b){console.error("Slide without id found");return}let p=ut.indexOf(b);p!==-1&&(t[a]=lt[p])});let n=()=>{let o=-1;return e.forEach((a,b)=>{a.classList.contains("swiper-slide-active")&&(o=b)}),o},i=n();console.log("activeSlide:",n(),t,e);let s=setInterval(()=>{if(ht(r)){let o=n();i!==o&&o!==-1&&(i=o,M[0]?.initiateLerp(JSON.parse(_[t[i]]),t[i])),M[0]?.currName==="base"&&M[0]?.targetName!==t[i]&&M[0]?.initiateLerp(JSON.parse(_[t[i]]),t[i])}else M[0]?.currName!=="base"&&M[0]?.targetName!=="base"&&M[0]?.initiateLerp(JSON.parse(_.base),"base")},100);return()=>{clearInterval(s)}}ue.valid?(F.push(Fe()),F.push(te())):le.valid&&$.push(te());function Ee(r,e){return r.classList?.contains("main")&&r.querySelector!=null&&r.querySelector(e)}function Pe(r,e,t){return Ee(r,e)?(M[t]=new Q(e.slice(1),!1),!0):!1}function Ie(r,e,t){return Ee(r,e)?(M[t]=null,!0):!1}var bt=new MutationObserver(r=>{r.forEach(e=>{e.addedNodes.forEach(t=>{Pe(t,"#canvas",0)&&F.length===0?(F.push(Fe()),setTimeout(()=>{F.push(te())},100),M[0]?.initialiseData(!1)):Pe(t,"#about-canvas",1)&&$.length===0&&(setTimeout(()=>{$.push(te())},100),M[1]?.initialiseData(!1))}),e.removedNodes.forEach(t=>{Ie(t,"#canvas",0)&&(F.forEach(n=>{n()}),F.length=0),Ie(t,"#about-canvas",1)&&($.forEach(n=>{n()}),$.length=0)})})});bt.observe(document.body,{childList:!0,subtree:!0});document.addEventListener("scroll",function(){let r=window.scrollY,e=document.documentElement.scrollHeight-window.innerHeight,t=r/e;ft(t)});function ft(r){M.forEach(e=>{e&&(e.transition=r)})}function pt(r){if(!r)return null;if(r.startsWith("#")){let e=r.slice(1),t,n,i;return e.length===3?(t=parseInt(e[0]+e[0],16),n=parseInt(e[1]+e[1],16),i=parseInt(e[2]+e[2],16)):e.length===6&&(t=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16),i=parseInt(e.substring(4,6),16)),!t||!n||!i?null:[t/255,n/255,i/255]}return r.startsWith("rgb")?r.match(/\d+/g).map(Number).map(t=>t/255):null}function te(){let r=document.querySelector(".main");if(!r)return console.log("Could not find main element"),()=>{};let e=new MutationObserver(function(t){t.forEach(function(n){if(n.type==="attributes"&&n.attributeName==="style"){let i=r.style.getPropertyValue("--color--text");if(i&&(M[0]!=null||M[1]!=null)){let s=pt(i);s&&Array.isArray(s)&&s.length>3&&(M[0]?M[0].colour=s.slice(0,3):M[1]&&(M[1].colour=s.slice(0,3)))}}})});return e.observe(r,{attributes:!0,attributeFilter:["style"]}),()=>{e.disconnect()}}export{Q as RenderApp};
